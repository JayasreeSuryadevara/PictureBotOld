try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return true;}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(name,func){Object.defineProperty(this,name,{get:func,enumerable:true,configurable:true});}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(name,func){Object.defineProperty(this,name,{set:func,enumerable:true,configurable:true});}});}}catch(defPropException){}function getInternetExplorerVersion(){try{var sAgent=window.navigator.userAgent;var Idx=sAgent.indexOf("MSIE");if(Idx>0){return parseInt(sAgent.substring(Idx+5,sAgent.indexOf(".",Idx)));}else{if(!!navigator.userAgent.match(/Trident\/7\./)){return 11;}else{return 0;}}}catch(err){}return null;}function checkIEVersion(){try{var ver=getInternetExplorerVersion();if(ver>0){if(confirm("ALERT! You're using an OLD unsupported version of Windows Internet Explorer. Only IE Edge and above are supported.")){window.location="https://mockflow.com";}else{window.location="https://mockflow.com";}}}catch(err){}}var MF_Global=(function(){function privateMethod(){}return{serverURL:function(){return"https://mockflow.com/app/";},getS3Bucket:function(){return"mfassets";},getS3URL:function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/";},projectImageURL:function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/designcloud/"+MF_UserSession.getUser().company+"/projects/thumbnails/";},projectSharedImageURL:function(company){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/designcloud/"+company+"/projects/thumbnails/";}};})();function MF_LicenseData(){var thisClass=this;this.licenses=null;this.userLicenses=null;}function MF_License(){var thisClass=this;this.id=null;this.clientid=null;this.users=0;this.edition=null;this.cost=0;this.txnID=null;this.status=null;this.period=null;this.monthly=false;this.createDate=null;var periodLbl="";var periodStr="";this.__defineGetter__("periodStr",function(){if(thisClass.period!=null){var curr_date=thisClass.period.getDate();var curr_month=thisClass.period.getMonth()+1;var curr_year=thisClass.period.getFullYear();var da="<span class='mfLicenseDate'>"+curr_date+"</span><span class='mfLicenseYear'>"+MF_Utils.getMonthByName(thisClass.period.getMonth())+" "+curr_year+"</span>";if(thisClass.status=="active"||thisClass.status=="invoiced"||thisClass.status=="failed"){return da;}if(thisClass.status=="expired"||thisClass.status=="Expired"){return da;}if(thisClass.status=="cancelled"){return da;}return da;}else{return thisClass.period;}});this.__defineSetter__("periodStr",function(val){periodStr=val;});this.__defineGetter__("periodLbl",function(){if(thisClass.period!=null){if(thisClass.status=="active"||thisClass.status=="invoiced"||thisClass.status=="failed"){return"Renews On";}if(thisClass.status=="expired"||thisClass.status=="Expired"){return"Expired On";}if(thisClass.status=="cancelled"){return"Expires On";}return"";}else{return thisClass.period;}});this.__defineSetter__("periodLbl",function(val){periodLbl=val;});this.__defineGetter__("userCountLabel",function(){if(thisClass.users>=1000){return"-";}else{return thisClass.users;}});this.__defineSetter__("userCountLabel",function(val){});var createDateFormat="";this.__defineGetter__("createDateFormat",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();return curr_year+"-"+curr_month+"-"+curr_date;}else{return thisClass.createDate;}});this.__defineSetter__("createDateFormat",function(val){createDateFormat=val;});var periodFormat="";this.__defineGetter__("periodFormat",function(){if(thisClass.period!=null){var curr_date=thisClass.period.getDate();var curr_month=thisClass.period.getMonth()+1;var curr_year=thisClass.period.getFullYear();return curr_year+"-"+curr_month+"-"+curr_date;}else{return thisClass.period;}});this.__defineSetter__("periodFormat",function(val){periodFormat=val;});var statusMsg="Active";this.__defineGetter__("statusMsg",function(){if(thisClass.status=="active"){return"Active";}if(thisClass.status=="cancelled"){return"Cancelled";}if(thisClass.status=="expired"){return"Expired";}if(thisClass.status=="failed"){return"Failed";}if(thisClass.status=="invoiced"){return"Invoiced";}return thisClass.status;});this.__defineSetter__("statusMsg",function(val){statusMsg=val;});var statusIcon="mficon-check";this.__defineGetter__("statusIcon",function(){if(thisClass.status=="active"){return"mficon-check";}if(thisClass.status=="cancelled"){return"mficon-close";}if(thisClass.status=="expired"){return"mficon-close";}if(thisClass.status=="failed"){return"mficon-close";}if(thisClass.status=="invoiced"){return"mficon-bill";}return thisClass.status;});this.__defineSetter__("statusIcon",function(val){statusIcon=val;});var statusColor="#787878";this.__defineGetter__("statusColor",function(){if(thisClass.status=="cancelled"){return"#ff0000";}if(thisClass.status=="failed"){return"#ff0000";}return"#787878";});this.__defineSetter__("statusColor",function(val){statusColor=val;});var showCancelBtn=true;this.__defineGetter__("showCancelBtn",function(){if(thisClass.status=="active"||thisClass.status=="failed"){return true;}else{return false;}});this.__defineSetter__("showCancelBtn",function(val){showCancelBtn=val;});var isPayPal=false;this.__defineGetter__("isPayPal",function(){if(thisClass.txnID.substring(0,2)=="S-"||thisClass.txnID.substring(0,2)=="s-"){return true;}return false;});this.__defineSetter__("isPayPal",function(val){isPayPal=val;});var isInvoice=false;this.__defineGetter__("isInvoice",function(){if(thisClass.txnID.substring(0,4)=="INV-"||thisClass.txnID.substring(0,4)=="inv-"||thisClass.txnID.substring(0,4)=="Inv-"){return true;}return false;});this.__defineSetter__("isInvoice",function(val){isInvoice=val;});var isFastSpring=false;this.__defineGetter__("isFastSpring",function(){var arr=thisClass.txnID.split("--__--");if(arr.length>=6){return true;}return false;});this.__defineSetter__("isFastSpring",function(val){isFastSpring=val;});var isMonthly=false;this.__defineGetter__("isMonthly",function(){var arr=thisClass.txnID.split("--__--");if(arr.length>=6){var str=arr[3];if(str=="monthly"){return true;}else{return false;}}return false;});this.__defineSetter__("isMonthly",function(val){isMonthly=val;});var subID="";this.__defineGetter__("subID",function(){var arr=thisClass.txnID.split("--__--");if(thisClass.isFastSpring){if(arr.length==6){return arr[4];}if(arr.length==7){return arr[5];}}else{return thisClass.txnID;}return thisClass.txnID;});this.__defineSetter__("subID",function(val){subID=val;});this.cast=function(obj){this.id=obj.id;this.clientid=obj.clientid;this.users=obj.users;this.edition=obj.edition;this.cost=obj.cost;this.txnID=obj.txnID;this.status=obj.status;this.period=obj.period;this.createDate=obj.createDate;};}function MF_LicenseUser(){var thisClass=this;this.clientid=null;this.id=null;this.email=null;this.createDate=null;this.canDowngrade=false;this.canChangeRole=false;this.role="member";this.__defineGetter__("canDowngrade",function(){if(thisClass.email.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()||(mf_main.accountController.currentUserRole!="owner"&&(thisClass.role=="owner"||thisClass.role=="admin"))){return false;}return true;});this.__defineSetter__("canDowngrade",function(val){thisClass.canDowngrade=val;});this.__defineGetter__("canChangeRole",function(){if(thisClass.email.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()||mf_main.accountController.currentUserRole!="owner"){return false;}return true;});this.__defineSetter__("canChangeRole",function(val){thisClass.canChangeRole=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.email;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,40);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.id=obj.id;this.clientid=obj.clientid;this.email=obj.email;this.createDate=obj.createDate;this.role=obj.role;};}function MF_LogShared(){var thisClass=this;this.id=null;this.projectName=null;this.projectid=null;this.creator=null;this.createDate=null;this.creatorName=null;this.logtype=null;this.opened=false;this.pageid=null;this.receiver=null;var linkable=false;this.__defineGetter__("linkable",function(){if(thisClass.logtype=="ADD-MEMBER-EDITOR"||thisClass.logtype=="ADD-MEMBER-REVIEWER"||thisClass.logtype=="ADD-MEMBER-APPROVER"||thisClass.logtype=="RATING"||thisClass.logtype=="ADD-VARIATION"||thisClass.logtype=="DEL-VARIATION"||thisClass.logtype=="ENABLE-SHARE-MEMBER"||thisClass.logtype=="MEMBER-EDITOR"||thisClass.logtype=="MEMBER-REVIEWER"||thisClass.logtype=="MEMBER-APPROVER"||thisClass.logtype=="OWNER"||thisClass.logtype=="COMMENTED"){return true;}return false;});this.__defineSetter__("linkable",function(val){linkable=val;});var logMessage="";this.__defineGetter__("logMessage",function(){var str=" ";var d=thisClass.createDate;if(d==null){d=new Date();}var curr_date=d.getDate();var curr_month=d.getMonth()+1;var curr_year=d.getFullYear();str=str+"["+curr_date+" "+MF_Utils.getMonthByName(d.getMonth())+" "+curr_year+"] - ";str=str+""+thisClass.creatorName+" &nbsp;";if(thisClass.logtype!="NEW"){str=str+" has";}if(thisClass.logtype=="ADD-MEMBER-EDITOR"){str=str+" added you as Co-Editor to this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="ADD-MEMBER-REVIEWER"){str=str+" added you as Reviewer to this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="ADD-MEMBER-APPROVER"){str=str+" added you as Approver to this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="ADD-MEMBER-ADMIN"){str=str+" added you as Administrator to this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="ADD-MEMBER"){str=str+" added you as Team Member \n\n";}if(thisClass.logtype=="MEMBER-UPGRADE"){str=str+" upgraded your account to premium \n\n";}if(thisClass.logtype=="MEMBER-DOWNGRADE"){str=str+" downgraded your account to basic \n\n";}if(thisClass.logtype=="DEL-MEMBER"){str=str+" removed you from this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="DISABLE-SHARE-MEMBER"){str=str+" disabled sharing with you for this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="ENABLE-SHARE-MEMBER"){str=str+" re-enabled sharing with you for this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="MEMBER-EDITOR"){str=str+" changed your role to 'Co-Editor' in this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="MEMBER-REVIEWER"){str=str+" changed your role to 'Reviewer' in this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="MEMBER-APPROVER"){str=str+" changed your role to 'Approver' in this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="MEMBER-ADMIN"){str=str+" changed your role to 'Administrator' in this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="COMMENTED"){str=str+" added a comment to this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="RATING"){str=str+" rated this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="ADD-VARIATION"){str=str+" added a new design variation to this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="OWNER"){str=str+" sent a copy of this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="CLONED"){str=str+" cloned a copy of this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="APPROVED"){str=str+" approved Design in this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="UNAPPROVED"){str=str+" removed the Approved Design in this project: '"+thisClass.projectName+"' \n\n";}if(thisClass.logtype=="NEW"){str=str+" : Notifications from other users are displayed here \n\n";}return str;});this.__defineSetter__("logMessage",function(val){logMessage=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.creator;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.id=obj.id;this.projectName=obj.projectName;this.projectid=obj.projectid;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.logtype=obj.logtype;this.opened=obj.opened;this.receiver=obj.receiver;this.pageid=obj.pageid;};}function MF_Log(){var thisClass=this;this.id=null;this.projectid=null;this.clientid=null;this.log=null;this.creator=null;this.createDate=null;this.creatorName=null;this.logtype=null;var logMessage="";this.__defineGetter__("logMessage",function(){var str=" ";var d=thisClass.createDate;if(d==null){d=new Date();}var curr_date=d.getDate();var curr_month=d.getMonth()+1;var curr_year=d.getFullYear();str=str+"["+curr_date+"-"+curr_month+"-"+curr_year+"] - ";if(MF_UserSession.getUser()&&thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){str=str+"You have";}else{str=str+thisClass.creatorName+" has";}str=str+" "+thisClass.log+" \n\n";return str;});this.__defineSetter__("logMessage",function(val){logMessage=val;});var logIcon="";this.__defineGetter__("logIcon",function(){var str="images/logicons/update.png";if(thisClass.logtype=="ADD-MEMBER-EDITOR"||thisClass.logtype=="ADD-MEMBER-REVIEWER"||thisClass.logtype=="ADD-MEMBER-APPROVER"||thisClass.logtype=="ADD-MEMBER-ADMIN"||thisClass.logtype=="ADD-MEMBER"){str="images/logicons/add_member.png";}if(thisClass.logtype=="DEL-MEMBER"){str="images/logicons/delete_member.png";}if(thisClass.logtype=="MEMBER-EDITOR"||thisClass.logtype=="MEMBER-REVIEWER"||thisClass.logtype=="MEMBER-APPROVER"||thisClass.logtype=="MEMBER-ADMIN"){str="images/logicons/membertype.png";}if(thisClass.logtype=="RENAMED"){str="images/logicons/rename_project.png";}if(thisClass.logtype=="COMMENTED"){str="images/logicons/comment.png";}if(thisClass.logtype=="RATING"){str="images/logicons/rating.png";}if(thisClass.logtype=="ADD-VARIATION"){str="images/logicons/addvariation.png";}if(thisClass.logtype=="DEL-VARIATION"){str="images/logicons/delvariation.png";}if(thisClass.logtype=="REVERT-REVISION"){str="images/logicons/revert_revision.png";}if(thisClass.logtype=="DEL-PAGE"){str="images/logicons/delete_page.png";}return str;});this.__defineSetter__("logIcon",function(val){logIcon=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.clientid=obj.clientid;this.log=obj.log;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.logtype=obj.logtype;};}function MF_UserInactive(){var thisClass=this;this.firstName=null;this.lastName=null;this.username=null;this.password=null;this.companyName=null;this.activateKey=null;this.expiry=null;this.createDate=null;}function MF_Company(){var thisClass=this;this.companyid=null;this.pid=null;this.dbserver=null;this.edition=null;this.createDate=null;this.creator=null;this.status=null;this.storage=null;this.plimit=1;}function MF_DashboardData(){var thisClass=this;this.logshared=null;this.labels=null;this.projects=null;}function MF_TeamMember(){var thisClass=this;this.id=null;this.userid=null;this.license=null;this.type=null;var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.userid;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.userid=obj.userid;this.license=obj.license;this.type=obj.type;this.id=obj.id;};}function MF_User(){var thisClass=this;this.firstName="dd";this.lastName="cc";this.createDate=null;this.username="";this.password="";this.company="";this.type="";this.companyName="";this.pid="";this.lastLogin=null;this.tokenKey="";this.projectsLeft=0;this.isBasic=true;this.accountType="";this.isTrial=false;this.hadTrial=false;this.enterprise=false;this.teamEditor=false;this.teamPremium=false;this.teamLicenseOwner="";this.plusEdition=null;this.daysLeft=0;var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var isNewLicense=false;this.__defineGetter__("isNewLicense",function(){if(thisClass.createDate!=null){var changeLicenseDate=new Date(2018,3,22);if(thisClass.createDate>changeLicenseDate){return true;}}return isNewLicense;});this.__defineSetter__("isNewLicense",function(val){});var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.username,60);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var isTeamLicenseOwner=false;this.__defineGetter__("isTeamLicenseOwner",function(){if(thisClass.teamPremium){if(thisClass.teamLicenseOwner==thisClass.username){return true;}}return false;});this.__defineSetter__("isTeamLicenseOwner",function(val){isTeamLicenseOwner=val;});}var MF_UserSession=(function(){var user=new MF_User();function privateMethod(){}return{getUser:function(){return user;},};})();function MF_SSOSettings(){var thisClass=this;this.clientid=null;this.enabled=false;this.provider=null;this.issuerid=null;this.signinurl=null;this.certificate=null;this.createDate=null;}function MF_LogController(){var thisClass=this;this.constructor=function(){};this.downgradeTeamMember=function(memberid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="upgraded account to premium: "+memberid;log.logtype="MEMBER-UPGRADE";log.projectid="";var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName="";logshared.projectid="";logshared.logtype=log.logtype;logshared.receiver=memberid;};this.upgradeTeamMember=function(memberid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="downgraded account to basic: "+memberid;log.logtype="MEMBER-DOWNGRADE";log.projectid="";var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName="";logshared.projectid="";logshared.logtype=log.logtype;logshared.receiver=memberid;};this.logMemberType=function(memberid,type,projectid,projectName){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="changed the role of "+memberid;if(type=="Editor"){log.log=log.log+" to Co-Editor";log.logtype="MEMBER-EDITOR";}else{if(type=="Admin"){log.log=log.log+" to Admin";log.logtype="MEMBER-ADMIN";}else{if(type=="Approver"){log.log=log.log+" to Approver";log.logtype="MEMBER-APPROVER";}else{log.log=log.log+" to Reviewer";log.logtype="MEMBER-REVIEWER";}}}log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;};this.logNewMember=function(memberid,type,projectid,projectName){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="shared this project with "+memberid;if(type=="Editor"){log.log=log.log+" (as Co-Editor)";log.logtype="ADD-MEMBER-EDITOR";}else{if(type=="Admin"){log.log=log.log+" (as Admin)";log.logtype="ADD-MEMBER-ADMIN";}else{if(type=="Approver"){log.log=log.log+" (as Approver)";log.logtype="ADD-MEMBER-Approver";}else{log.log=log.log+" (as Reviewer)";log.logtype="ADD-MEMBER-REVIEWER";}}}log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;};this.logDelMember=function(memberid,projectid,projectName){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="removed "+memberid+" from this project";log.logtype="DEL-MEMBER";log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;};this.logRename=function(oldname,project){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="renamed this project from '"+oldname+"'";log.logtype="RENAMED";log.projectid=project.id;};this.logDelVariation=function(project,varid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="deleted this design variation '"+varid+"'";log.logtype="DEL-VARIATION";log.projectid=project.id;};}var MF_Utils=(function(){var user=new MF_User();function privateMethod(){}return{getUser:function(){return user;},guidGenerator:function(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);};return"M"+(S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4())+Date.now();},resolveUrls:function(feedbackMsg){var resolvedMsg=feedbackMsg;var urlPattern=/\b(https?:\/\/)?[a-zA-Z0-9\/\-:]+(\.[a-z0-9-+&@#\/%?=~_|!:,;]+)+/gi;var protocolList=/^((https?):\/\/)/i;var linkTemplate="<a href='{0}' target='_blank'>{0}</a>";var urlList=urlPattern.exec(feedbackMsg),currentUrl="";while(urlList!==null){currentUrl=urlList[0];if(!protocolList.test(currentUrl)){currentUrl="http://"+currentUrl;}resolvedMsg=resolvedMsg.replace(urlList[0],linkTemplate.replace("{0}",currentUrl).replace("{0}",urlList[0]));urlList=urlPattern.exec(feedbackMsg);}return resolvedMsg;},trim:function(s){var l=0;var r=s.length-1;while(l<s.length&&s[l]==" "){l++;}while(r>l&&s[r]==" "){r-=1;}return s.substring(l,r+1);},getCheckBoxValue:function(chkID){if($("#"+chkID).is(":checked")){return true;}else{return false;}},localToGlobal:function(_el){var target=_el,target_width=target.offsetWidth,target_height=target.offsetHeight,target_left=target.offsetLeft,target_top=target.offsetTop,gleft=0,gtop=0,rect={};var moonwalk=function(_parent){if(!!_parent){gleft+=_parent.offsetLeft;gtop+=_parent.offsetTop;moonwalk(_parent.offsetParent);}else{return rect={top:target.offsetTop+gtop,left:target.offsetLeft+gleft,bottom:(target.offsetTop+gtop)+target_height,right:(target.offsetLeft+gleft)+target_width};}};moonwalk(target.offsetParent);return rect;},globalToLocalPoint:function(e,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(e.pageX-localoffsetX);var localy=Math.floor(e.pageY-localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},globalToLocalPoint2:function(x,y,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(x-localoffsetX);var localy=Math.floor(y-localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},localToGlobalPoint:function(xpt,ypt,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(xpt+localoffsetX);var localy=Math.floor(ypt+localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},getMonthByName:function(num){var m_names=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");return m_names[num];},isValidEmailAddress:function(emailAddress){var pattern2=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return pattern2.test(emailAddress);},findPos:function(obj){var curleft=curtop=0;if(obj.offsetParent){curleft=obj.offsetLeft;curtop=obj.offsetTop;while(obj=obj.offsetParent){curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}}return[curleft,curtop];},display_ActionIndicator:function(msg){$("#mfActionIndicator").css({position:"absolute",top:0,left:(($(window).width()/2)-($("#mfActionIndicator").width()/2))});$("#mfActionIndicatorMessage").text(msg);$("#mfActionIndicator").fadeTo("fast",1.5);$("#mfActionIndicator").css("z-index","1000");setTimeout(function(){$("#mfActionIndicator").css("display","none");},2000);return;},display_menu:function(parent,named,e){var menu_element=document.getElementById(named);menu_element.style.display="";menu_element.style.left=e.pageX+"px";menu_element.style.top=e.pageY+"px";if((e.pageY+10+$("#"+named).height())>$(window).height()){menu_element.style.top=(e.pageY-$("#"+named).height())+"px";}return;},hide_menu:function(named){var menu_element=document.getElementById(named);if(menu_element){menu_element.style.display="none";}return;},roundedRect2:function(ctx,x,y,w,h,cornerRadius){cornerRadius=cornerRadius/2;ctx.beginPath();var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;ctx.moveTo(x+cornerRadius,y);ctx.lineTo(x+w-cornerRadius,y);angle=-Math.PI/2;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+w,y+h-cornerRadius);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+cornerRadius,y+h);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x,y+cornerRadius);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.stroke();return;},roundedRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);ctx.stroke();return;},hexToRGB:function(hex,alpha){alpha=typeof(alpha)!="undefined"?alpha:"1";var rgbObj={red:((hex&16711680)>>16),green:((hex&65280)>>8),blue:((hex&255))};return"rgba("+rgbObj.red+","+rgbObj.green+","+rgbObj.blue+","+alpha+")";},randomInRange:function(min,max){var scale=max-min;return Math.floor(Math.random()*scale+min);},get_gravatar:function(email,size){var userName=MF_Utils.getMD5(email);var size=size||80;var profileImgUrl="https://www.mockflow.com/userProfileImage.jsp?userName="+userName+"&imageSize="+size;return profileImgUrl;},getMD5:function(data){var MD5=function(s){function L(k,d){return(k<<d)|(k>>>(32-d));}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H);}if(I|d){if(x&1073741824){return(x^3221225472^F^H);}else{return(x^1073741824^F^H);}}else{return(x^F^H);}}function r(d,F,k){return(d&F)|((~d)&k);}function q(d,F,k){return(d&k)|(F&(~k));}function p(d,F,k){return(d^F^k);}function n(d,F,k){return(F^(d|(~k)));}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F);}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F);}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F);}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F);}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]|(G.charCodeAt(H)<<d));H++;}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa;}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2);}return k;}function J(k){k=k.replace(/rn/g,"n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x);}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128);}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128);}}}return d;}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g);}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase();};var hashVal=MD5(data);return hashVal;},getIframeHost:function(app){if(location.host.indexOf("calhost")>0){if(app.toLowerCase()=="wireframe"){return"localhost:8080/MockFlow-WireframePro";}return"localhost:8080/MockFlow-"+app;}else{if(app.toLowerCase()=="wireframe"||app.toLowerCase()=="wireframepro"){return"wireframepro.mockflow.com";}return app.toLowerCase()+".mockflow.com";}},loadsScripts:function(path){var paths=path.map(function(scr){return $.getScript(scr);});paths.push($.Deferred(function(deferred){$(deferred.resolve);}));return $.when.apply($,paths);},copyToClipBoard:function(elementToCopy){elementToCopy.focus();elementToCopy.select();var returnState=false;try{if(document.execCommand("copy")){returnState=true;MF_Utils.display_ActionIndicator("Copied to clipboard");}}catch(errorMessage){console.log("HTML5 Copy to Clipboard is not supported in your browser");returnState=false;}return returnState;}};})();function MF_TeamController(){var thisClass=this;this.constructor=function(){$("#mfTeamModal").on("show",thisClass.teamModalShowHandler);$("#mfTeamAddMemberBox").on("textchange",thisClass.textChangeHandler);$("#mfTeamAddMemberBox").on("keypress",thisClass.enterHandler);$("#mfTeamManagerAddBtn").on("click",thisClass.addClickHandler);};this.teamMembers=new ArrayCollection();this.selectedMember=null;this.listed=false;this.teamModalShowHandler=function(e){thisClass.list(true);$("#mfTeamAddMemberBox").val("");thisClass.textChangeHandler(null);$("#mfTeamAddMemberBox").focus();};this.enterHandler=function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode=="13"){thisClass.addNewMember();}};this.addClickHandler=function(e){thisClass.addNewMember();};this.textChangeHandler=function(e){var arr=$.grep(thisClass.teamMembers.toArray(),function(value,i){var str1=value.userid.toLowerCase();var str2=$("#mfTeamAddMemberBox").val().toLowerCase();if(str1.indexOf(str2)>=0){return true;}else{return false;}});for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);var showItem=false;for(var k=0;k<arr.length;k++){if(item.userid.toLowerCase()==arr[k].userid.toLowerCase()){showItem=true;}}if(!showItem){$("#mfTeamMemberItem"+item.id).css("height","0px");$("#mfTeamMemberItem"+item.id).css("display","none");}else{$("#mfTeamMemberItem"+item.id).css("height","30px");$("#mfTeamMemberItem"+item.id).css("display","block");}}};this.applyTemplate=function(arr,sync){if(sync==null){sync=false;}$("#mfTeamList").empty();$("#mfTeamManagerLoader").css("display","none");thisClass.teamMembers=new ArrayCollection();var cachedTemplate=mf_main.getTemplateFromCache("mfTeamMemberTemplate");if(cachedTemplate==null){$.get("templates/dashboard/TeamMember.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfTeamMemberTemplate").html());mf_main.addTemplateToCache("mfTeamMemberTemplate",template);thisClass.renderTeamMemberItem(template,arr,sync);});}else{thisClass.renderTeamMemberItem(cachedTemplate,arr,sync);}};this.renderTeamMemberItem=function(template,arr,sync){for(var i=0,j=arr.length;i<j;i++){thisClass.teamMembers.addItem(arr[i]);$("#mfTeamList").append(template(arr[i]));$("#mfTeamMemberItem"+arr[i].id).on("mouseover",thisClass.memberItemOver);$("#mfTeamMemberItem"+arr[i].id).on("mouseout",thisClass.memberItemOut);$("#mfTeamMemberItem"+arr[i].id).on("click",thisClass.memberItemClick);}$(".mfTeamMemberDelBtn").on("click",thisClass.deleteMemberHandler);};this.deleteMemberHandler=function(e){e.stopImmediatePropagation();thisClass.selectDeleteMember($(this).attr("id"));thisClass.deleteMember();};this.list=function(sync){if(sync==null){sync=false;}if(thisClass.listed){return;}$("#mfTeamManagerLoader").css("display","block");MF_TeamManager.list(MF_UserSession.getUser().company,{callback:function(arr){if(arr!=null){thisClass.listed=true;thisClass.applyTemplate(arr,sync);}}});};this.memberItemOver=function(e){if(thisClass.selectedMember!=null&&("mfTeamMemberItem"+thisClass.selectedMember.id)==$(this).attr("id")){}else{$(this).css({"background-color":"#f6f6f6"});}};this.memberItemOut=function(e){if(thisClass.selectedMember!=null&&("mfTeamMemberItem"+thisClass.selectedMember.id)==$(this).attr("id")){}else{$(this).css({"background-color":"#fff"});}};function clearMemberSelection(){for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);$("#mfTeamMemberItem"+item.id).css({"background-color":"#fff"});}}this.selectMember=function(pid){clearMemberSelection();for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);if("mfTeamMemberItem"+item.id==pid){this.selectedMember=item;$("#mfTeamMemberItem"+item.id).css({"background-color":"#f0f0f0"});break;}}};this.selectDeleteMember=function(pid){for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);if("mfTeamMemberDelBtn"+item.id==pid){this.selectedMember=item;break;}}};this.memberItemClick=function(e){thisClass.selectMember($(this).attr("id"));};this.deleteMember=function(){if(thisClass.selectedMember!=null){var answer=confirm('Remove "'+thisClass.selectedMember.userid+'" from your Team List?');if(answer){$("#mfTeamMemberItem"+thisClass.selectedMember.id).css("height","0px");$("#mfTeamMemberItem"+thisClass.selectedMember.id).css("display","none");$("#mfShareMemberItem"+thisClass.selectedMember.id).css("height","0px");$("#mfShareMemberItem"+thisClass.selectedMember.id).css("display","none");var tind=thisClass.teamMembers.getItemIndex(thisClass.selectedMember);if(tind!=-1){thisClass.teamMembers.removeItemAt(tind);}MF_TeamManager.deleteMember(MF_UserSession.getUser(),thisClass.selectedMember.userid,{callback:function(str){$("#mfTeamManagerLoader").css("display","none");}});}}};this.IsExist=function(email){for(var i=0;i<thisClass.teamMembers.size();i++){var user=thisClass.teamMembers.getItemAt(i);if(user.userid.toLowerCase()==email.toLowerCase()){return true;}}return false;};this.addNewMember=function(){var memberID=$("#mfTeamAddMemberBox").val();if(memberID.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){alert("You cannot share it with yourself");return;}if(memberID==""){return;}memberID=memberID.toLowerCase();if(!MF_Utils.isValidEmailAddress(memberID)){alert("Invalid email");return;}if(thisClass.IsExist(memberID)){alert("User already exists");return;}var mem=new MF_TeamMember();mem.id=MF_Utils.guidGenerator();mem.userid=$("#mfTeamAddMemberBox").val();mem.type="";mem.license="";$("#mfTeamAddMemberBox").val("");thisClass.textChangeHandler(null);thisClass.teamMembers.addItemAt(mem,0);thisClass.applyTemplate(thisClass.teamMembers.toArray(),true);MF_TeamManager.addMember(MF_UserSession.getUser().company,mem,MF_UserSession.getUser(),{callback:function(str){$("#mfTeamManagerLoader").css("display","none");if(str=="success"){}else{alert("Some error occurred");}}});};}function MF_DashboardController(){var thisClass=this;this.appsDefaultSortOrder=["Wireframe","SiteMap","StyleGuide","DesignCollab","AnnotatePro","WebsitePro"];this.currentApp="";this.constructor=function(){thisClass.makeAppListingSortable();$(".licenseAppImg").tooltip({animation:false});$(".mfFeatureTooltip").tooltip();$(".mfLoginApp").on("click",thisClass.openApp);$(".mfOpenAppCls").on("click",thisClass.openApp);$("#contact_btn").on("click",thisClass.submitMessage);$("#mfToggleAppSideSide").on("click",thisClass.toggleAppListSideBar);$("#mfUserName").html(MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName);$("#mfLogout").on("click",function(){window.Intercom("shutdown");location.href="../checkLogin.jsp?logout=yes";});$("#mfUpgradePromoClose").on("click",function(e){e.stopImmediatePropagation();$("#mfUpgradePromo").hide();});$("#mfSideBarHeader,#mfAccountMenuSidebar").on("click",function(e){mf_main.openAccountMenu();});$(window).on("hashchange",function(e){var appInUrlHash=window.location.hash.substr(1);var app=null;if(appInUrlHash){app=$("#mfAppListing .mfLoginApp[data-mfprodapp="+appInUrlHash.toLowerCase()+"]").attr("data-mfapp");}if(!app){app="Wireframe";}if(app){thisClass.showApp(app);}});$("#mfUpgradePremiumModal").on("show.bs.modal",function(e){$("#mfWireframeOnlyPromo").css("display","block");});$("#mfUpgradePremiumModal").on("hidden.bs.modal",function(e){$("#mfWireframeOnlyPromo").css("display","none");});$(window).resize(function(){thisClass.interfaceResize();});thisClass.interfaceResize();};this.submitMessage=function(){var subject=$.trim($("input#subject").val());if(subject==""){$("input#subject").focus();alert("Subject cannot be empty");return;}var message=$.trim($("textarea#message").val());if(message==""){$("textarea#message").focus();alert("Message cannot be empty");return;}mf_main.closeContactForm();alert("Message Sent");MF_DashboardManager.contactCustomerSupport(MF_UserSession.getUser(),subject,message,navigator.appVersion,function(){});};this.sortAppListing=function(order){if(order){for(var i=0;i<order.length;i++){var ele=$("#mfAppListing .mfLoginApp[data-mfapp="+order[i]+"]");$("#mfAppListing .mfLoginApp[data-mfapp="+order[i]+"]").remove();$("#mfAppListing").append(ele);}$(".mfLoginApp").on("click",thisClass.openApp);$(".mfLoginApp").tooltip();}};this.showIntialMockflowAppIframe=function(){var appInUrlHash=window.location.hash.substr(1);var app=null;try{if(appInUrlHash){app=$("#mfAppListing .mfLoginApp[data-mfprodapp="+appInUrlHash.toLowerCase()+"]").attr("data-mfapp");}else{var app=$($("#mfAppListing .mfLoginApp")[0]).attr("data-mfapp");window.location.hash=app;}}catch(e){}if(!app){app="Wireframe";}if(app){thisClass.showApp(app);}};this.openApp=function(e){if(e){e.stopImmediatePropagation();}var selectedApp=$(this).attr("data-mfapp");thisClass.showApp(selectedApp);window.location.hash=selectedApp;};this.toggleAppListSideBar=function(){if(!$("#mfControl").hasClass("mfAppListCollapse")){$("#mfControl").addClass("mfAppListCollapse");$("#mfControl").removeClass("mfAppListOpen");$("#mfProjectSpace").css("width","calc(100% - 75px)");$("#mfToggleAppSideSide span").removeClass("mficon-angle-left").addClass("mficon-angle-right");}else{$("#mfControl").addClass("mfAppListOpen");$("#mfControl").removeClass("mfAppListCollapse");$("#mfProjectSpace").css("width","calc(100% - 65px)");$("#mfToggleAppSideSide span").removeClass("mficon-angle-right").addClass("mficon-angle-left");}};this.makeAppListingSortable=function(){$("#mfAppListing").sortable({containment:"parent",axis:"y",stop:function(event,ui){thisClass.storeAppsSortOrder();}});};this.storeAppsSortOrder=function(){var newSortOrder=[];$("#mfAppListing .mfLoginApp").each(function(){newSortOrder.push($(this).attr("data-mfapp"));});$(".mfLoginApp").tooltip("hide");var clientid=MF_UserSession.getUser().company;if(clientid){MF_DashboardManager.storeUserAppListingSortOrder(newSortOrder.toString(),clientid,function(){});thisClass.sortAppListing(newSortOrder);}};this.showApp=function(app){if(app){if(thisClass.currentApp==app){return;}thisClass.addSelectedClassToAppSelected(app);if(!$("#"+app+"_iframe").length){var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();$("#mfContentLoaderContainer_"+app).show();var glogin="false";if(mf_main.gAccess){glogin="true";}MF_Authentication.addSecureKeyHashSwitchApp(MF_UserSession.getUser(),publicid,privateid,{callback:function(pubid){var host=MF_Utils.getIframeHost(app);var url="//"+host+"/index.jsp?publicid="+pubid+"&from=designcloud&googleuser="+glogin;$("#"+app).prepend('<iframe id="'+app+'_iframe"  width="100%" height="100%" frameBorder="0" scrolling="no"  src="'+url+'"></iframe>');thisClass.makeSelectedAppVisible(app);$("#"+app).find("iframe").on("load",function(){$("#mfContentLoaderContainer_"+app).hide();$("#"+app+"_iframe").show();});}});}else{thisClass.addSelectedClassToAppSelected(app);thisClass.makeSelectedAppVisible(app);}}};this.addSelectedClassToAppSelected=function(app){if(app){$(".mfAppIFrames").hide();$(".mfLoginApp").removeClass("selected");$(".mfLoginApp").removeClass("mfloginappselected");$(".mfLoginApp[data-mfapp="+app+"]").addClass("selected");$(".mfLoginApp[data-mfapp="+app+"]").addClass("mfloginappselected");thisClass.currentApp=app;window.location.hash=app;}};this.makeSelectedAppVisible=function(app){if(app){$("#"+app).show();try{var iframeWin=document.getElementById(app+"_iframe").contentWindow;if(iframeWin){iframeWin.postMessage("resizedashboard","*");}}catch(e){console.log(e);}}};this.interfaceResize=function(){$("#mfAppListing").height($(window).height()-100);$("#mfAccountMenuBoxApps").height($(window).height()-30);};}function MF_Main(){var thisClass=this;this.UID=MF_Utils.guidGenerator();this.PUBLICID="";this.teamController=new MF_TeamController();this.accountController=new MF_AccountController();this.logController=new MF_LogController();this.dashboardController=new MF_DashboardController();this.showAccountMenu=false;this.apporder="";this.gname="";this.gsessionid="";this.gappAccess=false;this.glogin=false;this.gAccess=false;this.thirdPartyAuthAccess=null;this.cachedTemplates=new Object();this.moduleCache={};this.onLoadInterface=function(){thisClass.interfaceResize();dwr.engine.setErrorHandler(thisClass.errorDWRHandler);$("#mfDashboardProfileImg").css("background-image","url('"+MF_Utils.get_gravatar(MF_UserSession.getUser().username,32)+"')");$("#mfAccountMenuLogout").on("click",thisClass.logoutHandler);$("#mfAccountMenuUpgrade").on("click",thisClass.openPricing);$("#mfAccountMenuHelp").on("click",thisClass.openHelpLink);$("#mfOpenTeamBtn").on("click",thisClass.openTeamModalHandler);$("#mfUpgradePromo").on("click",thisClass.openUpgradeModal);$("#mfCloseUpgradeDialogBtn").on("click",thisClass.closeUpgradeDialog);this.teamController.constructor();this.accountController.constructor();this.logController.constructor();thisClass.dashboardController.constructor();this.registerHandlebarHelpers();this.accountController.updateProfileImage();if(MF_UserSession.getUser().isBasic){if(MF_UserSession.getUser().hadTrial){$("#mfUpgradePromoTxt").text("Trial expired. Upgrade now!");}else{$("#mfUpgradePromoTxt").text("Get 25% off, power-ups and offline mode on yearly plans");}$(".mfBottomBarCls").hide();$("#mfUpgradePromo").show();}else{if(MF_UserSession.getUser().isTrial){if(MF_UserSession.getUser().daysLeft<=0){$("#mfUpgradePromoTxt").text("Trial expired. Upgrade now!");}else{if(MF_UserSession.getUser().daysLeft==1){$("#mfUpgradePromoTxt").text(MF_UserSession.getUser().daysLeft+" day left in trial");}else{$("#mfUpgradePromoTxt").text(MF_UserSession.getUser().daysLeft+" days left in trial");}}$(".mfBottomBarCls").hide();$("#mfUpgradePromo").show();}}if(thisClass.apporder!=""&&thisClass.apporder!=null){var dborderarr=thisClass.apporder.split(",");var notpresentarr=new Array();for(var i=0;i<thisClass.dashboardController.appsDefaultSortOrder.length;i++){var appchk=thisClass.dashboardController.appsDefaultSortOrder[i];var apppres=false;for(var k=0;k<dborderarr.length;k++){if(dborderarr[k]==appchk){apppres=true;}}if(apppres==false){notpresentarr.push(appchk);}}if(notpresentarr.length>0){var newarr=new Array();for(var k=0;k<dborderarr.length;k++){if(k==1){newarr.push(dborderarr[k]);for(var n=0;n<notpresentarr.length;n++){newarr.push(notpresentarr[n]);}}else{newarr.push(dborderarr[k]);}}dborderarr=newarr;}thisClass.dashboardController.sortAppListing(dborderarr);}else{thisClass.dashboardController.sortAppListing(thisClass.dashboardController.appsDefaultSortOrder);}$("#mfDashboardInterface").show();mf_main.interfaceResize(true);var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();thisClass.PUBLICID=publicid;MF_Authentication.addFirstSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){thisClass.dashboardController.showIntialMockflowAppIframe();}});$(".close").on("click",thisClass.closeHandler);$("html").on("click",thisClass.closePopUpHandler);$(".mfTxtLink").on("mouseover",thisClass.txtLinkOver);$(".mfTxtLink").on("mouseout",thisClass.txtLinkOut);$(".mfImgLink").on("mouseover",thisClass.imgLinkOver);$(".mfImgLink").on("mouseout",thisClass.imgLinkOut);$('[data-ptoggle="Pricingtooltip"]').tooltip();$('[data-toggle="tooltip"]').tooltip({container:"body"});$("#mfAccountMenuBoxBackground").on("click",thisClass.closeAccountMenu);$("#mfContactFormBackground").on("click",thisClass.closeContactForm);$("#mfContactMailBtn").on("click",thisClass.openContactForm);$("#mfContactFormCloseBtn").on("click",thisClass.closeContactForm);$("#mfViewChangelogBtn").on("click",function(){window.open("https://blog.mockflow.com/");});$("#mfAccountMenuCloseBtn").on("click",thisClass.closeAccountMenu);$(document).bind("keydown",function(evt){if(evt.keyCode=="27"){thisClass.closeAccountMenu();mf_main.accountController.closeAccountSettings();thisClass.closeContactForm();}});mf_main.accountController.getLicenseData();var b=MF_UserSession.getUser().isBasic;if(b==false){b=MF_UserSession.getUser().isTrial;}window.Intercom("boot",{app_id:"zymiyo06",name:MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName,email:MF_UserSession.getUser().username,created_at:(MF_UserSession.getUser().createDate.getTime()/1000),basic:b});$(".mfPricingToolTip").tooltip({html:true});};this.closeAccountMenu=function(){thisClass.showAccountMenu=false;$("#mfAccountMenuBoxBackground").css("display","none");$("#mfAccountMenuBox").css("display","none");};this.closeContactForm=function(){thisClass.showContactForm=false;$("#mfContactFormBackground").css("display","none");$("#mfContactFormBox").css("display","none");};this.openAccountMenu=function(){thisClass.showAccountMenu=true;$("#mfAccountMenuBoxBackground").show(0,onDivShow);function onDivShow(){mf_main.interfaceResize();$("#mfAccountMenuBox").css("display","block");$("#mfAccountMenuBox").css("left","-65px");$("#mfAccountMenuBox").transition({left:"0px",easing:"easeOutExpo",duration:500,complete:function(){}});}};this.openContactForm=function(){thisClass.showContactForm=true;$("input#subject").val("");$("textarea#message").val("");$("#mfContactFormBackground").show(0,onDivShow);$("#mfAccountMenuBoxBackground").css("display","none");$("#mfAccountMenuBox").css("display","none");function onDivShow(){mf_main.interfaceResize();$("#mfContactFormBox").css("display","block");$("#mfContactFormBox").css("left","-65px");$("#mfContactFormBox").transition({left:"0px",easing:"easeOutExpo",duration:500,complete:function(){}});}};this.errorDWRHandler=function(){};this.openUpgradeModal=function(){thisClass.accountController.openUpgradeModal();};this.openUpgradeDialog=function(){$("#mfUpgradeDialog").show(0,onDivShow);function onDivShow(){$("#mfUpgradeDialog").css("display","block");mf_main.interfaceResize();thisClass.openSettingsTab=null;$("#mfUpgradeDialog").css({position:"absolute",top:($(window).height()+$("#mfUpgradeDialog").height()),left:0});$("#mfUpgradeDialog").transition({top:"0px",easing:"easeOutExpo",duration:500,complete:function(){}});}};this.closeUpgradeDialog=function(){$("#mfUpgradeDialog").css("display","none");};this.openHelpLink=function(){window.open("https://support.mockflow.com");};this.txtLinkOver=function(e){$(this).css("text-decoration","underline");};this.txtLinkOut=function(e){$(this).css("text-decoration","none");};this.imgLinkOver=function(e){$(this).css("opacity",0.5);};this.imgLinkOut=function(e){$(this).css("opacity",1);};this.addTemplateToCache=function(key,template){this.cachedTemplates[key]=template;};this.getTemplateFromCache=function(key){return this.cachedTemplates[key];};this.openTeamModalHandler=function(e){$("#mfTeamModal").modal();};this.closePopUpHandler=function(){$("#mfLoginBoxModal").css("display","none");$("#mfAccountMenuBoxModal").css("display","none");$("#mfChoosePhotoPopup").css("display","none");};this.logoutHandler=function(){window.Intercom("shutdown");window.open("../checkLogin.jsp?logout=yes","_self");};this.openPricing=function(){thisClass.accountController.openUpgradeModal();};this.closeHandler=function(){thisClass.closeDialog();};this.interfaceResize=function(resizeSets){if($("#mfAccountMenuBoxModal").css("display")=="block"){$("#mfAccountMenuBoxModal").css("display","none");}if($("#mfLoginBoxModal").css("display")=="block"){$("#mfLoginBoxModal").css("display","none");}if($("#mfContactFormBoxModal").css("display")=="block"){$("#mfContactFormBoxModal").css("display","none");}$("#mfContentPlaceHolder").height($(window).height());$("#mfDesignBlank").height($("#mfContentPlaceHolder").height()-$("#mfDesignSetsBar").height()-5);if(resizeSets==true){$("#mfDesignSets").width($(window).width()-20);}if(thisClass.accountController){thisClass.accountController.resize();}thisClass.closePopUpHandler();if(thisClass.showAccountMenu){$("#mfAccountMenuBox").height($(window).height());$("#mfAccountMenuBoxBackground").height($(window).height());$("#mfAccountMenuBoxBackground").width($(window).width());}if(thisClass.showContactForm){$("#mfContactFormBox").height($(window).height());$("#mfContactFormBoxBackground").height($(window).height());$("#mfContactFormBoxBackground").width($(window).width());$(".mfContactMessageField").height($(window).height()-500);}$("#mfControl").height($(window).height()-$("#mfDesignSetTitle").height());$(".mfDesignListingCls").width($(window).width()-$("#mfControl").width()-20);if($("#mfSubFailedModal").css("display")=="block"){$("#mfSubFailedModal").css({position:"absolute",top:(($(window).height()/2)-($("#mfSubFailedModal").height()/2)),left:(($(window).width()/2)-($("#mfSubFailedModal").width()/2))});$("#mfSettingsBackground").height($(window).height());$("#mfSettingsBackground").width($(window).width());}if($("#mfUpgradeDialog").css("display")=="block"){$("#mfUpgradeDialog").height($(window).height());$("#mfUpgradeDialog").width($(window).width());$("#mfUpgradeDialog").css({"overflow-y":"auto"});}$(".centered-axis-xy").css({position:"absolute",top:(($(window).height()/2)+1),left:(($(window).width()/2)-57)});if(thisClass.dashboardController){thisClass.dashboardController.interfaceResize();}};this.registerHandlebarHelpers=function(){};this.closeDialog=function(){$(".modal").modal("hide");};}var mockflowAppURLHash="";function MF_Login(){var thisClass=this;this.constructor=function(){$("#login_btn").on("click",thisClass.loginHandler);$("#forgot_btn").on("click",thisClass.forgotPasswordHandler);};this.isValidEmailAddress=function(emailAddress){var pattern2=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return pattern2.test(emailAddress);};this.loginHandler=function(e){$("#login_btn").css("opacity","0.5");$(".error").hide();var email=$("input#username").val();if(email!=""){if(!thisClass.isValidEmailAddress(email)){$("input#username").focus();$("#login_btn").css("opacity","1");alert("Invalid E-mail address");return false;}}else{$("input#username").focus();$("#login_btn").css("opacity","1");alert("Email is required");return false;}var password=$("input#password").val();if(password==""){$("input#password").focus();$("#login_btn").css("opacity","1");alert("Password is Required");return false;}var remember=true;$("#rememberme").val("true");$("#login_btn").hide();$("#loginformsignin").hide();$("#loging_btn").show();return true;};this.rememberMeClickHandler=function(e){e.stopPropagation();var remember=true;};this.forgotPasswordHandler=function(e){$(".error").hide();var email=$("input#username").val();if(email!=""){if(!thisClass.isValidEmailAddress(email)){$("input#username").focus();alert("Invalid E-mail address");return;}}else{$("input#username").focus();alert("Email is required");return;}alert("Check E-mail for resetting Password.  (If not received check Spam folder) ");$.post("forgotPassword.jsp",{uname:email},function(data){data=jQuery.trim(data);if(data=="success"){}else{alert("Some error occurred, is this an registered E-mail?");}});return;};}var gBtnClicked=false;function gBtnHandler(){gBtnClicked=true;}function signinCallback(authResult){if(gBtnClicked==true){}else{return;}if(authResult.status["signed_in"]){gapi.client.load("plus","v1",function(){var request=gapi.client.plus.people.get({userId:"me"});request.execute(function(resp){var primaryEmail="";for(var i=0;i<resp.emails.length;i++){if(resp.emails[i].type==="account"){primaryEmail=resp.emails[i].value;}}var publicmid=guidGenerator();var privatemid=guidGenerator();$("#signinButton").hide();$("#mfGoogleSignin").show();$.post("glogin.jsp",{publicid:publicmid,privateid:privatemid,email:primaryEmail,dname:resp.displayName,gtoken:authResult.id_token,userid:resp.id},function(data){data=data.trim();if(data=="pdlsuccess"){window.location.replace("index.jsp"+mockflowAppURLHash);}else{$("#signinButton").show();$("#mfGoogleSignin").hide();alert("Authentication via Google Failed");}});});});}else{console.log("Sign-in state: "+authResult.error);}}function guidGenerator(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);};return(S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4());}function MF_AccountController(){var thisClass=this;this.selectedAccountBtnID="";this.selectedLicenseTab="mfAccountUserLicenseBtn";this.selectedLicense=null;this.tempChangeID="";this.usedLicenses=0;this.totalLicenses=0;this.teamPackPrice=29;this.billingType="monthly";this.upgradeDialogState="none";this.openSettingsTab=null;this.licenseCollection=new ArrayCollection();this.licenseUserCollection=new ArrayCollection();this.emailCollection=new Array();this.licensesListed=false;this.invoiceFetched=false;this.invoiceDetails="";var isEnterprise=false;this.pricingDetails={teamPackUnitPrice:13,premiumUnitPrice:19,threeMonthDiscountRate:10,sixMonthDiscountRate:15,yearlyDiscountRate:25,};this.currentUserRole="member";this.constructor=function(){$("#mfDashboardProfileImg").on("click",thisClass.openAccountSettingsModalHandler);$("#mfAccountMenuMyAccount").on("click",thisClass.openAccountSettingsModalHandler);$("#mfAccountMenuUserLicenses").on("click",thisClass.openUserLicensesModalHandler);$("#mfAccountMenuSubscriptions").on("click",thisClass.openSubscriptionsModalHandler);$("#mfSettingsCloseBtn").on("click",thisClass.closeAccountSettings);$("#monthlyBilling1").on("click",thisClass.monthlyBillingSelect);$("#yearlyBilling1").on("click",thisClass.yearlyBillingSelect);$("#monthlyBilling4").on("click",thisClass.monthlyBillingSelect2);$("#yearlyBilling4").on("click",thisClass.yearlyBillingSelect2);$(".mfEditProfileEmailChk").click(thisClass.emailNotificationHandler);$("#mfEditProfileFirstNameInput").keypress(function(e){if(e.which==13){e.stopPropagation();thisClass.changeProfileName();}});$("#mfEditProfileLastNameInput").keypress(function(e){if(e.which==13){e.stopPropagation();thisClass.changeProfileName();}});$("#mfEditProfileNameBtn").on("click",thisClass.changeProfileName);$("#mfEditProfileIDInput").keypress(function(e){if(e.which==13){e.stopPropagation();thisClass.changeAccountUsernameHandler();}});$("#mfEditProfileIDBtn").on("click",thisClass.changeAccountUsernameHandler);$(".mfAccountPurchaseLicenseBtn").on("click",thisClass.openUpgradeModal);$("#mfDetailsProfileUpgradeBtn").on("click",thisClass.openUpgradeModal);$("#mfDetailsProfileImgEdit").on("click",thisClass.editProfileImage);$("#mfEditDeleteAccountBtn").on("click",thisClass.deleteAccountHandler);$("#mfEditProfilePassBtn").on("click",thisClass.changePasswordHandler);$("#mfSSOSettingsSaveBtn").on("click",thisClass.SSOSettingsSaveHandler);$("#mfDetailsLicenseAlert").on("click",thisClass.alertButtonHandler);$("#mfDelAccountModalBtn").click(thisClass.deleteMockFlowAccount);$("#mfDelAccountModalCloseBtn").click(thisClass.closeHandler);$("#mfDelAccountModal").on("show",thisClass.deleteAccountShowHandler);$("#mfChangeIDModalBtn").click(thisClass.changeAccountUsername);$("#mfChangeIDModalCloseBtn").click(thisClass.closeHandler);$("#mfChangeIDModal").on("show",thisClass.changeIDShowHandler);$("#mfChangeIDModal").on("shown",thisClass.changeIDShownHandler);$(".mfAccountSettingBtn").on("mouseover",thisClass.accountBtnOver);$(".mfAccountSettingBtn").on("mouseout",thisClass.accountBtnOut);$(".mfAccountSettingBtn").on("click",thisClass.accountBtnClick);$(".mfAccountLicenseTab").on("click",thisClass.licenseBtnClick);$("#mfAddLicenseUserBtn").on("click",thisClass.addLicenseUserHandler);$("#mfAddLicenseUserInput").on("textchange",thisClass.searchLicenseUserHandler);$("#mfAddLicenseUserInput").on("keypress",thisClass.enterLicenseUserHandler);$("#mfInvoiceModal").on("show",thisClass.invoiceShowHandler);$("#mfInvoiceGetBtn").on("click",thisClass.generateInvoiceHandler);$("#mfUnSubFeedbackBtn").click(thisClass.openUnSubModalHandler);$("#mfUnSubBtn").click(thisClass.unSubscribeHandler);$("#mfUpgradePremiumBtn").on("click",thisClass.upgradePremiumHandler);$("#mfPricingSelectMenuWrapper").find("li").click(function(){$("#mfPricingSelectMenuWrapper li").removeClass("mfSelectedPlanCls");$(this).addClass("mfSelectedPlanCls");$(".qtyminus").css("opacity","0.3");thisClass.pricingCalcHandler();});$("#mfPricingSelectMenuWrapper").find("li").eq(0).click();$("#mfPriceCalcModal").on("shown",thisClass.teamPriceShownHandler);$("#mfPriceUsers").on("textchange",thisClass.userChangeHandler);$("#mfYearPriceUsers").on("textchange",thisClass.userChangeHandler);$("#mfAccountProfileBtn").on("click",thisClass.openProfileCanvas);$("#mfEditPhoto,#mfDetailsProfileImgDiv").on("click",thisClass.openPhotoOptionsPopup);$("#mfProfilePhotoUploadFile").on("change",thisClass.profileUploadFileSelectHandler);$("#mfChooseExistingPhoto").on("click",function(){$("#mfChoosePhotoPopup").hide();$("#mfProfilePhotoUploadFile").trigger("click");});$("#mfChooseWebCam").on("click",thisClass.openPhotoCanvas);$("#mfRemovePhoto").on("click",thisClass.removeProfilePhoto);$("#mfTakePhotoBtn").on("click",thisClass.takePhoto);$(".mfEditphotoCancelBtn").on("click",thisClass.closeMyProfileModal);$("#mfUseUploadedProfilePhoto").on("click",thisClass.mfUseUploadedProfilePhoto);$("#mfDialogBackground").on("click",thisClass.closeMyProfileModal);$(".qtyplus").on("click",thisClass.userCountIncrement);$(".qtyminus").on("click",thisClass.userCountDecrement);thisClass.setEmailAlerts();$("#mfSSOSettingsEnabled").change(function(){$("#mfSSOSettingsWrapper").toggleClass("mfSSOSettingsWrapperDisabled");});$("#mfSSOSettingsProviderInput").change(thisClass.SSOProviderHandler);$(".mfSSOSettingsCustomData").tooltip();$(".mfSSOSettingsCustomData").click(function(){MF_Utils.copyToClipBoard($(this));});};this.monthlyBillingSelect2=function(e){thisClass.billingType="monthly";$("#mfYearPriceUsers").val("1");$("#mfYearlyaddonmsg").text("Total monthly price");$("#mfTeamYearCustom").attr("value",MF_UserSession.getUser().username+"--__--1--__--teampremium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearCustomPath").attr("value","/mockflowmonthlyteamsubscription");$("#mfTeamYearQuantity").attr("value","1");thisClass.userChangeHandler();};this.yearlyBillingSelect2=function(e){thisClass.billingType="yearly";$("#mfYearPriceUsers").val("1");$("#mfYearlyaddonmsg").text("Total yearly price");$("#mfTeamYearCustom").attr("value",MF_UserSession.getUser().username+"--__--1--__--teampremium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearCustomPath").attr("value","/mockflowdesigncloudteamsubscription");$("#mfTeamYearQuantity").attr("value","1");thisClass.userChangeHandler();};this.pricingCalcHandler=function(e){var tval=3;if(MF_UserSession.getUser().teamPremium){tval=1;$("#mfUserSpellTPack").text("user");}$(".qty").val(tval);$(".mfTeamPackUserCountPt").text(tval);var mfSelectedPlan=$(".mfSelectedPlanCls").attr("data-duration");var mfPremiumPrice;var mfTeamPackPrice;var mfPlanDuration;var mfPremiumAttrVal;var mfTeamPackAttrVal;var mfPremiumPath;var mfTeamPath;var mfPricingTeamBtnVal;var mfPricingPremiumBtnVal;var planName;var mfHeadingOffer;var mfCurrentTeamPrice=$("#teamPrice1").text();var mfCurrentPremiumPrice=$("#premiumPrice1").text();$("#mfHeadingOfferTxt2").show();if(mfSelectedPlan=="yearly"){mfPlanName="Yearly";mfHeadingOffer="Save "+thisClass.pricingDetails.yearlyDiscountRate+"%";mfPremiumPrice=Math.round(thisClass.pricingDetails.premiumUnitPrice-(thisClass.pricingDetails.premiumUnitPrice*(thisClass.pricingDetails.yearlyDiscountRate/100)));mfTeamPackPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*tval)-((thisClass.pricingDetails.teamPackUnitPrice*tval)*(thisClass.pricingDetails.yearlyDiscountRate/100)));mfPlanDuration="per month, billed yearly";mfPremiumAttrVal="--__--1--__--premium--__--yearly--__--FS-";mfTeamPackAttrVal="--__--"+tval+"--__--teampremium--__--yearly--__--FS-";mfPremiumPath="/mockflowdesigncloudyearlysubscription";mfTeamPath="/mockflowdesigncloudteamsubscription";mfPricingTeamBtnVal="Upgrade now - Save $"+(((thisClass.pricingDetails.teamPackUnitPrice*tval)-mfTeamPackPrice)*12);mfPricingPremiumBtnVal="Upgrade now - Save $"+((thisClass.pricingDetails.premiumUnitPrice-mfPremiumPrice)*12);$("#mfPriceOfferBtn").show();$("#mfOffDiscount").text("3 months free");$("#mfOffWork").text("Offline mode");$("#mfOffPower").text("Power-ups");$(".mfOffClsPt").html("&#10004;");$(".mfOffClsPt").css("color","#000000");$("#mfOffStmt").text(" only on ");$("#mfPowerupEnabled").show();$(".mfTeamPackAnnualPt").css("text-decoration","none");}else{if(mfSelectedPlan=="halfyearly"){mfPlanName="6 months";mfHeadingOffer="Save "+thisClass.pricingDetails.sixMonthDiscountRate+"% on";mfPremiumPrice=Math.round(thisClass.pricingDetails.premiumUnitPrice-(thisClass.pricingDetails.premiumUnitPrice*(thisClass.pricingDetails.sixMonthDiscountRate/100)));mfTeamPackPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*tval)-((thisClass.pricingDetails.teamPackUnitPrice*tval)*(thisClass.pricingDetails.sixMonthDiscountRate/100)));mfPlanDuration="per month, billed half-yearly";mfPremiumAttrVal="--__--1--__--premium--__--halfyearly--__--FS-";mfTeamPackAttrVal="--__--"+tval+"--__--teampremium--__--halfyearly--__--FS-";mfPremiumPath="/mockflowpremiumhalfyearlysubscription";mfTeamPath="/mockflowteampackhalfyearlysubscription";mfPricingTeamBtnVal="Upgrade now - Save $"+(((thisClass.pricingDetails.teamPackUnitPrice*tval)-mfTeamPackPrice)*6);mfPricingPremiumBtnVal="Upgrade now - Save $"+((thisClass.pricingDetails.premiumUnitPrice-mfPremiumPrice)*6);$("#mfPriceOfferBtn").hide();$("#mfOffDiscount").text("Save 15%");$("#mfOffWork").text("No offline mode");$("#mfOffPower").text("No power-ups");$(".mfOffClsPt").html("&#10008;");$(".mfOffClsPt").css("color","#000");$("#mfOffDiscountTick").html("&#10004;");$("#mfOffDiscountTick").css("color","#000000");$("#mfOffStmt").text(" - ");$("#mfPowerupEnabled").hide();$(".mfTeamPackAnnualPt").css("text-decoration","line-through");}else{if(mfSelectedPlan=="3months"){mfPlanName="3 months";mfHeadingOffer="Save "+thisClass.pricingDetails.threeMonthDiscountRate+"% on";mfPremiumPrice=Math.round(thisClass.pricingDetails.premiumUnitPrice-(thisClass.pricingDetails.premiumUnitPrice*(thisClass.pricingDetails.threeMonthDiscountRate/100)));mfTeamPackPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*tval)-((thisClass.pricingDetails.teamPackUnitPrice*tval)*(thisClass.pricingDetails.threeMonthDiscountRate/100)));mfPlanDuration="per month, billed quarterly";mfPremiumAttrVal="--__--1--__--premium--__--3months--__--FS-";mfTeamPackAttrVal="--__--"+tval+"--__--teampremium--__--3months--__--FS-";mfPremiumPath="/mockflowpremium3monthssubscription";mfTeamPath="/mockflowteampack3monthssubscription";mfPricingTeamBtnVal="Upgrade now - Save $"+(((thisClass.pricingDetails.teamPackUnitPrice*tval)-mfTeamPackPrice)*3);mfPricingPremiumBtnVal="Upgrade now - Save $"+((thisClass.pricingDetails.premiumUnitPrice-mfPremiumPrice)*3);$("#mfPriceOfferBtn").hide();$("#mfOffDiscount").text("Save 10%");$("#mfOffWork").text("No offline mode");$("#mfOffPower").text("No power-ups");$(".mfOffClsPt").html("&#10008;");$(".mfOffClsPt").css("color","#000");$("#mfOffDiscountTick").html("&#10004;");$("#mfOffDiscountTick").css("color","#000000");$("#mfOffStmt").text(" - ");$("#mfPowerupEnabled").hide();$(".mfTeamPackAnnualPt").css("text-decoration","line-through");}else{if(mfSelectedPlan=="monthly"){mfPlanName="Monthly";mfHeadingOffer="Save 0% on";mfPremiumPrice=Math.round(thisClass.pricingDetails.premiumUnitPrice);mfTeamPackPrice=Math.round(thisClass.pricingDetails.teamPackUnitPrice*tval);mfPlanDuration="per month, billed monthly";mfPremiumAttrVal="--__--1--__--premium--__--monthly--__--FS-";mfTeamPackAttrVal="--__--"+tval+"--__--teampremium--__--monthly--__--FS-";mfPremiumPath="/mockflowmonthlysubscription";mfTeamPath="/mockflowmonthlyteamsubscription";mfPricingTeamBtnVal="Upgrade now - Save $0";mfPricingPremiumBtnVal="Upgrade now - Save $0";$("#mfPriceOfferBtn").hide();$("#mfOffDiscount").text("No discount");$("#mfOffWork").text("No offline mode");$("#mfOffPower").text("No power-ups");$(".mfOffClsPt").html("&#10008;");$(".mfOffClsPt").css("color","#000");$("#mfOffStmt").text(" - ");$("#mfPowerupEnabled").hide();$(".mfTeamPackAnnualPt").css("text-decoration","line-through");}else{}}}}$("#premiumPrice1").prop("priceCount",parseInt(mfCurrentPremiumPrice)).animate({priceCount:parseInt(mfPremiumPrice)},{duration:300,easing:"swing",step:function(pricecount){$("#premiumPrice1").text(Math.ceil(pricecount));}});$("#teamPrice1").prop("priceCount",parseInt(mfCurrentTeamPrice)).animate({priceCount:parseInt(mfTeamPackPrice)},{duration:300,easing:"swing",step:function(pricecount){$("#teamPrice1").text(Math.ceil(pricecount));}});$(".mfPlanDurationInfo").text(mfPlanDuration);$("#mfPremiumCustom").attr("value",MF_UserSession.getUser().username+mfPremiumAttrVal+(new Date().getTime()).toString());$("#mfTeamPackCustom1").attr("value",MF_UserSession.getUser().username+mfTeamPackAttrVal+(new Date().getTime()).toString());$("#mfPremiumPath").attr("value",mfPremiumPath);$("#mfTeamPackPath1").attr("value",mfTeamPath);$("#mfPremiumYlyBtn").attr("value",mfPricingPremiumBtnVal);$("#mfTeamYlyBtn").attr("value",mfPricingTeamBtnVal);$("#mfPlanSelected").text(mfPlanName);};this.resize=function(e){if($("#mfSettingsDialog").css("display")=="block"){$("#mfSettingsDialog").height($(window).height());$("#mfSettingsDialog").width($(window).width());$("#mfSettingsDialog").css({position:"absolute",top:($(window).height()-$("#mfSettingsDialog").height())});$("#mfSettingsBackground").height($(window).height());$("#mfSettingsBackground").width($(window).width());$("#mfSettingsSideBar").height($(window).height());}};this.closeAccountSettings=function(){$("#mfSettingsBackground").css("display","none");$("#mfSettingsDialog").css("display","none");thisClass.closeMyProfileModal();};this.openUserLicensesModalHandler=function(e){thisClass.openSettingsTab="userlicenses";thisClass.openAccountSettingsModalHandler();$(".mfSettingsTabPanel li").removeClass("active");$("#mfAccountLicenseBtn").addClass("active");};this.openSubscriptionsModalHandler=function(e){thisClass.openSettingsTab="subscriptions";thisClass.openAccountSettingsModalHandler();$(".mfSettingsTabPanel li").removeClass("active");$("#mfAccountSubscriptionBtn").addClass("active");};this.openAccountSettingsModalHandler=function(e){mf_main.closeAccountMenu();mf_main.accountController.bindData();$("#mfSettingsBackground").show(0,onDivShow);function onDivShow(){$("#mfSettingsDialog").css("display","block");mf_main.interfaceResize();if(thisClass.openSettingsTab=="userlicenses"){thisClass.openAccountTab("mfAccountLicenseBtn");}if(thisClass.openSettingsTab=="subscriptions"){thisClass.openAccountTab("mfAccountSubscriptionBtn");}thisClass.openSettingsTab=null;$("#mfSettingsDialog").css({position:"absolute",top:($(window).height()+$("#mfSettingsDialog").height()),left:0});$("#mfSettingsDialog").transition({top:"0px",easing:"easeOutExpo",duration:500,complete:function(){}});if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().isTrial){$("#mfBasicUpgradeBtn").show();}else{$("#mfBasicUpgradeBtn").hide();}if(MF_UserSession.getUser().accountType=="Enterprise"&&MF_UserSession.getUser().username.toLowerCase()==MF_UserSession.getUser().teamLicenseOwner.toLowerCase()){$("#mfAccountSSOBtn").show();}else{$("#mfAccountSSOBtn").hide();$("#mfAccountSettingsSSO").hide();}}};this.userCountIncrement=function(e){if(e){e.preventDefault();}var currentVal=parseInt($(".qty").val());var mfSelectedPlan=$(".mfSelectedPlanCls").attr("data-duration");if(!isNaN(currentVal)){$(".qty").val(currentVal+1);$(".mfTeamPackUserCountPt").text(currentVal+1);thisClass.currentUserCount($(".qty").val());}else{if(MF_UserSession.getUser().teamPremium){$(".qty").val(1);$(".mfTeamPackUserCountPt").text(1);}else{$(".qty").val(3);$(".mfTeamPackUserCountPt").text(3);}}$("#mfTeamPackCustom1").attr("value",MF_UserSession.getUser().username+"--__--"+$(".qty").val()+"--__--teampremium--__--"+mfSelectedPlan+"--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity1").attr("value",$(".qty").val());if(currentVal>9){$("#mfTeamPackSym").text("");$(".mfPayFormTeam").hide();$("#mfTeamPackQuoteBtn").show();$("#teamPrice1").text("Custom");}else{$("#mfTeamPackSym").text("$");$(".mfPayFormTeam").show();$("#mfTeamPackQuoteBtn").hide();$("#teamPrice1").attr("value",$(".qty").val());}return;};this.userCountDecrement=function(e){if(e){e.preventDefault();}var mfSelectedPlan=$(".mfSelectedPlanCls").attr("data-duration");if(MF_UserSession.getUser().teamPremium){var currentVal=parseInt($(".qty").val());if(!isNaN(currentVal)&&currentVal>1){$(".qty").val(currentVal-1);$(".mfTeamPackUserCountPt").text(currentVal-1);thisClass.currentUserCount($(".qty").val());}else{$(".qty").val(1);$(".mfTeamPackUserCountPt").text(1);thisClass.currentUserCount($(".qty").val());}}else{var currentVal=parseInt($(".qty").val());if(!isNaN(currentVal)&&currentVal>3){$(".qty").val(currentVal-1);$(".mfTeamPackUserCountPt").text(currentVal-1);thisClass.currentUserCount($(".qty").val());}else{$(".qty").val(3);$(".mfTeamPackUserCountPt").text(3);thisClass.currentUserCount($(".qty").val());}}$("#mfTeamPackCustom1").attr("value",MF_UserSession.getUser().username+"--__--"+$(".qty").val()+"--__--teampremium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamPackPrice").attr("value",$(".qty").val());$("#mfTeamYearQuantity1").attr("value",$(".qty").val());if(currentVal>11){$("#mfTeamPackSym").text("");$(".mfPayFormTeam").hide();$("#mfTeamPackQuoteBtn").show();$("#teamPrice1").text("Custom");}else{$("#mfTeamPackSym").text("$");$(".mfPayFormTeam").show();$("#mfTeamPackQuoteBtn").hide();$("#teamPrice1").attr("value",$(".qty").val());}return;};this.currentUserCount=function(value){var mfSelectedPlan=$(".mfSelectedPlanCls").attr("data-duration");var mfTeamActualPrice=Math.round(thisClass.pricingDetails.teamPackUnitPrice*value);value=Number(value);if(value==3){if(!MF_UserSession.getUser().teamPremium){$(".qtyminus").css({opacity:"0.3",cursor:"not-allowed"});}if(mfSelectedPlan=="yearly"){var mfTeamDiscountPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*3)-((thisClass.pricingDetails.teamPackUnitPrice*3)*(thisClass.pricingDetails.yearlyDiscountRate/100)));$("#teamPrice1").text(mfTeamDiscountPrice);var mfPricingTeamBtnVal="Upgrade now - Save $"+((mfTeamActualPrice-mfTeamDiscountPrice)*12);}else{if(mfSelectedPlan=="halfyearly"){var mfTeamDiscountPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*3)-((thisClass.pricingDetails.teamPackUnitPrice*3)*(thisClass.pricingDetails.sixMonthDiscountRate/100)));$("#teamPrice1").text(mfTeamDiscountPrice);var mfPricingTeamBtnVal="Upgrade now - Save $"+((mfTeamActualPrice-mfTeamDiscountPrice)*6);}else{if(mfSelectedPlan=="3months"){var mfTeamDiscountPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*3)-((thisClass.pricingDetails.teamPackUnitPrice*3)*(thisClass.pricingDetails.threeMonthDiscountRate/100)));$("#teamPrice1").text(mfTeamDiscountPrice);var mfPricingTeamBtnVal="Upgrade now - Save $"+((mfTeamActualPrice-mfTeamDiscountPrice)*3);}else{if(mfSelectedPlan=="monthly"){$("#teamPrice1").text(Math.round(thisClass.pricingDetails.teamPackUnitPrice*3));var mfPricingTeamBtnVal="Upgrade now - Save $0";}else{}}}}}else{$(".qtyminus").css({opacity:"1",cursor:"pointer"});$(".mfTeampackUsersCount").text(value);if(value==1){if(MF_UserSession.getUser().teamPremium){$("#mfUserSpellTPack").text("user");$(".qtyminus").css({opacity:"0.3",cursor:"not-allowed"});}}else{if(MF_UserSession.getUser().teamPremium){$("#mfUserSpellTPack").text("users");}}if(mfSelectedPlan=="yearly"){var mfTeamDiscountPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*value)-((thisClass.pricingDetails.teamPackUnitPrice*value)*(thisClass.pricingDetails.yearlyDiscountRate/100)));$("#teamPrice1").text(mfTeamDiscountPrice);var mfPricingTeamBtnVal="Upgrade now - Save $"+((mfTeamActualPrice-mfTeamDiscountPrice)*12);}else{if(mfSelectedPlan=="halfyearly"){var mfTeamDiscountPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*value)-((thisClass.pricingDetails.teamPackUnitPrice*value)*(thisClass.pricingDetails.sixMonthDiscountRate/100)));$("#teamPrice1").text(mfTeamDiscountPrice);var mfPricingTeamBtnVal="Upgrade now - Save $"+((mfTeamActualPrice-mfTeamDiscountPrice)*6);}else{if(mfSelectedPlan=="3months"){var mfTeamDiscountPrice=Math.round((thisClass.pricingDetails.teamPackUnitPrice*value)-((thisClass.pricingDetails.teamPackUnitPrice*value)*(thisClass.pricingDetails.threeMonthDiscountRate/100)));$("#teamPrice1").text(mfTeamDiscountPrice);var mfPricingTeamBtnVal="Upgrade now - Save $"+((mfTeamActualPrice-mfTeamDiscountPrice)*3);}else{if(mfSelectedPlan=="monthly"){$("#teamPrice1").text(Math.round(thisClass.pricingDetails.teamPackUnitPrice*value));var mfPricingTeamBtnVal="Upgrade now";}else{}}}}}$("#mfTeamYlyBtn").attr("value",mfPricingTeamBtnVal);};this.userChangeHandler=function(){if(thisClass.billingType=="yearly"){var users=$("#mfYearPriceUsers").val();if(isNaN(users)){if(MF_UserSession.getUser().teamPremium){users=1;}else{users=3;}$("#mfYearPriceUsers").val(users.toString());if(MF_Utils.trim(users)==""){if(MF_UserSession.getUser().teamPremium){users=1;}else{users=3;}}}else{if(MF_UserSession.getUser().teamPremium){if(users<1){users=1;if(isNaN(users)&&MF_Utils.trim(users)!=""){$("#mfYearPriceUsers").val(users.toString());}}}else{if(users<3){users=3;if(isNaN(users)&&MF_Utils.trim(users)!=""){$("#mfYearPriceUsers").val(users.toString());}}}}if(users>=50){users=50;}var totalprice=(users*156);$("#mfYearRegularPrice").text("$ "+(users*19).toString());var calculatedPrice=totalprice-(totalprice*0.15);if(users==1){calculatedPrice=117;}else{if(users==3){calculatedPrice=348;}else{calculatedPrice=users*117;}}if(users>=3){var userCount=users-3;var userMonthlyPrice=39+(userCount*13);var userYearlyPrice=(userMonthlyPrice*(13*10));calculatedPrice=(userMonthlyPrice-((userMonthlyPrice*25)/100));calculatedPrice=(calculatedPrice*12);}$("#mfYearAvgPrice").text("$ "+Math.round(calculatedPrice)+" / year");$("#mfYearDiscountPrice").text("$ "+Math.round(calculatedPrice/12).toString());$("#mfYearAmountSaved").text("$ "+Math.round((users*19)-(calculatedPrice/12)).toString());thisClass.teamPackPrice=calculatedPrice;if(MF_UserSession.getUser().teamPremium){$("#mfTeamYearCustom").attr("value",MF_UserSession.getUser().username+"--__--"+users.toString()+"--__--teampremium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity").attr("value",users.toString());}if(users==1){$("#mfNumYearUserLicenses").text("For "+users.toString()+" license");}else{$("#mfNumYearUserLicenses").text("For "+users.toString()+" licenses");}$("#mfTeamYearPrice").val(Math.round(thisClass.teamPackPrice).toString());}else{var users=$("#mfPriceUsers").val();if(MF_UserSession.getUser().teamPremium){users=$("#mfPriceUsers").val();}if(isNaN(users)){if(MF_UserSession.getUser().teamPremium){users=1;}else{users=3;}$("#mfPriceUsers").val(users.toString());if(MF_Utils.trim(users)==""){if(MF_UserSession.getUser().teamPremium){users=1;}else{users=3;}}}else{if(MF_UserSession.getUser().teamPremium){if(users<1){users=1;if(isNaN(users)&&MF_Utils.trim(users)!=""){$("#mfPriceUsers").val(users.toString());}}}else{if(users<3){users=3;if(isNaN(users)&&MF_Utils.trim(users)!=""){$("#mfPriceUsers").val(users.toString());}}}}if(users>=50){users=50;}var totalprice=(users*19);$("#mfRegularPrice").text("$ "+totalprice.toString());var calculatedPrice=totalprice;if(!MF_UserSession.getUser().teamPremium){calculatedPrice=totalprice-(totalprice*0.15);}else{calculatedPrice=(users*14);}if(users==1){calculatedPrice=14;}else{if(users==3){calculatedPrice=39;}else{calculatedPrice=users*14;}}if(users>=3){var userCount=users-3;var userMonthlyPrice=39+(userCount*13);calculatedPrice=userMonthlyPrice;}$("#mfYearAvgPrice").text("$ "+Math.round(calculatedPrice)+" / month");$("#mfDiscountPrice").text("$ "+Math.round(calculatedPrice).toString());$("#mfAmountSaved").text("$ "+Math.round(totalprice-calculatedPrice).toString());thisClass.teamPackPrice=calculatedPrice;$("#mfTeamCustom").attr("value",MF_UserSession.getUser().username+"--__--"+users.toString()+"--__--teampremium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamQuantity").attr("value",users.toString());if(MF_UserSession.getUser().teamPremium){$("#mfTeamYearCustom").attr("value",MF_UserSession.getUser().username+"--__--"+users.toString()+"--__--teampremium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity").attr("value",users.toString());}if(users==1){$("#mfNumUserLicenses").text("For "+users.toString()+" license");}else{$("#mfNumUserLicenses").text("For "+users.toString()+" licenses");}$("#mfTeamPrice").val(Math.round(thisClass.teamPackPrice).toString());}};this.teamPriceShownHandler=function(){$("#mfPriceUsers").focus();};this.upgradePremiumHandler=function(){};this.teamPriceHandler=function(){mf_main.closeDialog();if(thisClass.billingType=="yearly"){if(MF_UserSession.getUser().teamPremium){$("#mfYearPriceUsers").val("1");$("#mfTeamPriceTerms").hide();$("#mfTeamYearCustom").attr("value",MF_UserSession.getUser().username+"--__--1--__--teampremium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity").attr("value",1);thisClass.userChangeHandler();}else{$("#mfYearPriceUsers").val("3");$("#mfTeamYearPriceTerms").show();$("#mfTeamYearCustom").attr("value",MF_UserSession.getUser().username+"--__--3--__--teampremium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity").attr("value",3);thisClass.userChangeHandler();}$("#mfPriceCalcYearModal").modal();}else{if(MF_UserSession.getUser().teamPremium){$("#mfPriceUsers").val("1");$("#mfTeamYearPriceTerms").hide();$("#mfTeamCustom").attr("value",MF_UserSession.getUser().username+"--__--1--__--teampremium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamQuantity").attr("value",1);thisClass.userChangeHandler();}else{$("#mfPriceUsers").val("3");$("#mfTeamPriceTerms").show();$("#mfTeamCustom").attr("value",MF_UserSession.getUser().username+"--__--3--__--teampremium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamQuantity").attr("value",3);thisClass.userChangeHandler();}$("#mfPriceCalcModal").modal();}};this.openUpgradeModal=function(){mf_main.closeAccountMenu();mf_main.closeDialog();$("#mfPricingSelectMenuWrapper").find("li").eq(0).click();$(".qty").val(3);$(".qtyminus").css("opacity","0.3");$(".mfTeamPackUserCountPt").text(3);if(MF_UserSession.getUser().isBasic||MF_UserSession.getUser().isTrial){$("#mfPremiumCustom").attr("value",MF_UserSession.getUser().username+"--__--1--__--premium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfPremiumCustom2").attr("value",MF_UserSession.getUser().username+"--__--1--__--premium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamPackCustom1").attr("value",MF_UserSession.getUser().username+"--__--3--__--teampremium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity1").attr("value","3");$("#mfTeamPackCustom2").attr("value",MF_UserSession.getUser().username+"--__--3--__--teampremium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity2").attr("value","3");mf_main.openUpgradeDialog();}else{if(MF_UserSession.getUser().teamPremium){if(!MF_UserSession.getUser().isTeamLicenseOwner){alert("Since your license is managed by "+MF_UserSession.getUser().teamLicenseOwner+" , you cannot purchase add-on license");return;}$(".qty").val(2);$(".mfTeamPackUserCountPt").text(2);thisClass.userCountDecrement();$("#mfTeamPackDescModal").text("");$("#mfUpgradePremiumModalCompare").hide();$("#mfTeamPackCustom1").attr("value",MF_UserSession.getUser().username+"--__--1--__--teampremium--__--yearly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity1").attr("value","1");$("#mfTeamPackCustom2").attr("value",MF_UserSession.getUser().username+"--__--1--__--teampremium--__--monthly--__--FS-"+(new Date().getTime()).toString());$("#mfTeamYearQuantity2").attr("value","1");$(".mfPlanBenifits").hide();$("#mfHeadingOffer").hide();$("#mfPricingSelectMenuWrapper").css("left","0px");$("#mfUpgradePremiumModalTopic").text("Purchase add-on licenses for your TeamPack");$("#mfPremiumPriceBlock").hide();$(".mfPricingDialogWrapper").css("max-width","600px");$(".mfPricingColumn").css({width:"100%","min-height":"370px"});$(".mfTeamPack").css("border-left","0px");$("#mfPricingSelectMenuWrapper .dropdown-menu").css("left","-180px");mf_main.openUpgradeDialog();}else{window.open("https://mockflow.com/pricing");}}};this.invoiceShowHandler=function(e){if(thisClass.invoiceFetched==true){$("#mfInvoiceModalFetchScreen").css("display","none");$("#mfInvoiceModalGenerateScreen").css("display","none");$("#mfInvoiceModalInputScreen").css("display","block");}else{$("#mfInvoiceModalInputScreen").css("display","none");$("#mfInvoiceModalGenerateScreen").css("display","none");$("#mfInvoiceModalFetchScreen").css("display","block");thisClass.fetchInvoiceDetails();}};this.alertButtonHandler=function(e){thisClass.openAccountTab("mfAccountLicenseBtn");};this.generateInvoiceHandler=function(e){var url="http://auth.mockflow.com/mockflow/invoice/invoice.php?";if(thisClass.selectedLicense.isFastSpring){var arr=thisClass.selectedLicense.txnID.split("--__--");if(arr.length==7){url=url+"sid="+arr[5];}else{url=url+"sid="+arr[4];}}else{url=url+"sid="+thisClass.selectedLicense.txnID;}url=url+"&licenses="+thisClass.selectedLicense.users.toString();url=url+"&cost="+thisClass.selectedLicense.cost.toString();url=url+"&userid="+MF_UserSession.getUser().username;url=url+"&clientid="+MF_UserSession.getUser().company;if(thisClass.selectedLicense.status=="invoiced"){url=url+"&ptype=By Invoice";}else{url=url+"&ptype=By PayPal";}var curr_date=thisClass.selectedLicense.period.getDate();var curr_month=thisClass.selectedLicense.period.getMonth()+1;var curr_year=thisClass.selectedLicense.period.getFullYear()-1;thisClass.invoiceDetails=$("#mfInvoiceDetails").val();var tempDetails=thisClass.invoiceDetails;tempDetails=tempDetails.replace(/\n/g,"<br/>");tempDetails=tempDetails.replace(/\r/g,"<br/>");url=url+"&details="+tempDetails;url=url+"&paydate="+$("#mfInvoiceDateSelect").val();window.open(url);};this.fetchInvoiceDetails=function(){MF_LicenseManager.getCompanyDetails(MF_UserSession.getUser(),MF_UserSession.getUser().company,{callback:function(details){thisClass.invoiceFetched=true;thisClass.invoiceDetails=details;if(thisClass.invoiceDetails==""){thisClass.invoiceDetails=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;}$("#mfInvoiceDetails").val(thisClass.invoiceDetails);$("#mfInvoiceModalInputScreen").css("display","block");$("#mfInvoiceModalGenerateScreen").css("display","none");$("#mfInvoiceModalFetchScreen").css("display","none");}});};this.getSelectedLicense=function(pid){for(var i=0;i<thisClass.licenseCollection.size();i++){var item=thisClass.licenseCollection.getItemAt(i);if("mfSubInvoiceBtn"+item.id==pid){return item;}}return null;};this.getSelectedLicenseByCancelBtn=function(pid){for(var i=0;i<thisClass.licenseCollection.size();i++){var item=thisClass.licenseCollection.getItemAt(i);if("mfSubCancelBtn"+item.id==pid){return item;}}return null;};this.getSelectedLicenseByBillingBtn=function(pid){for(var i=0;i<thisClass.licenseCollection.size();i++){var item=thisClass.licenseCollection.getItemAt(i);if("mfSubBillingBtn"+item.id==pid){return item;}}return null;};this.unSubscribeHandler=function(e){mf_main.closeDialog();window.open("http://www.paypal.com");MF_AccountManager.reportFeedback(MF_UserSession.getUser(),$("#mfUnSubDetails").val(),{callback:function(){}});};this.openUnSubModalHandler=function(e){mf_main.closeDialog();$("#mfUnSubDetails").val("");$("#mfUnSubModal").modal();};this.changePasswordHandler=function(e){if(MF_Utils.trim($("#mfEditProfileOldPassInput").val())==""){alert("Error! Password cannot be blank");return;}if(MF_Utils.trim($("#mfEditProfileNewPassInput").val())==""){alert("Error! Password cannot be blank");return;}if(MF_Utils.trim($("#mfEditProfileNewPassInput").val())!=MF_Utils.trim($("#mfEditProfileNewPassInput2").val())){alert("Error! New Password does not match retype");return;}var oldpass=MF_Utils.trim($("#mfEditProfileOldPassInput").val());var newpass=MF_Utils.trim($("#mfEditProfileNewPassInput").val());$("#mfEditProfileNewPassInput").val("");$("#mfEditProfileNewPassInput2").val("");$("#mfEditProfileOldPassInput").val("");MF_AccountManager.changePassword(MF_UserSession.getUser().company,MF_UserSession.getUser().username,oldpass,newpass,{callback:function(user){mf_main.closeDialog();if(user!=null){var conf=confirm("Password has been changed, Please immediately restart the application");if(conf){window.location="https://www.mockflow.com/";}else{window.location="https://www.mockflow.com/";}}else{alert("Error! Cannot change password");}}});};this.deleteAccountShowHandler=function(e){$("#mfDelAccountModalPass").val("");};this.getLicenseData=function(){if(thisClass.licensesListed==false){thisClass.licensesListed=true;$("#mfProfileLicenseLoader").css("display","block");MF_LicenseManager.getLicenseData(MF_UserSession.getUser(),MF_UserSession.getUser().company,false,{callback:function(licenseData){$("#mfProfileLicenseLoader").css("display","none");thisClass.licenseCollection=new ArrayCollection();thisClass.licenseUserCollection=new ArrayCollection();var failedLicenseObj=null;for(var l1=0;l1<licenseData.licenses.length;l1++){var licenseObj=licenseData.licenses[l1];var litem=new MF_License();litem.cast(licenseObj);if(litem.txnID.indexOf("FS-MFENTERPRISE")>=0){isEnterprise=true;}if(isEnterprise==false){if(litem.txnID.indexOf("teampremium")>=0){if(litem.txnID.indexOf("yearly")>=0){isEnterprise=true;}}}thisClass.licenseCollection.addItem(litem);if(litem.status.toLowerCase()!="Expired".toLowerCase()){thisClass.totalLicenses=thisClass.totalLicenses+litem.users;}if(litem.status=="failed"){failedLicenseObj=litem;}}if(licenseData.userLicenses){for(var l1=0;l1<licenseData.userLicenses.length;l1++){var licenseUserObj=licenseData.userLicenses[l1];var luitem=new MF_LicenseUser();luitem.cast(licenseUserObj);thisClass.licenseUserCollection.addItem(luitem);if(luitem.email.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){thisClass.currentUserRole=luitem.role;}}}thisClass.usedLicenses=thisClass.licenseUserCollection.size();$("#mfAssignedLicense").text(thisClass.licenseUserCollection.size().toString());$("#mfTotalLicense").text(thisClass.totalLicenses.toString());if(isEnterprise&&thisClass.totalLicenses>50){$(".mfLicenseCountWrapper").hide();$(".mfLicenseListWrapper").css("width","100%");}thisClass.displayLicenseAlert();thisClass.applyLicenseUserTemplate();if(thisClass.currentUserRole=="owner"){thisClass.applySubscriptionTemplate();}else{$("#mfSubscriptionPlaceHolder").show();$("#mfSubscriptionList").hide();$("#mfSubscriptionListLoader").hide();}if(failedLicenseObj!=null){$("#mfSettingsBackground").show();$("#mfSubFailedModal").css("zIndex",20000);$("#mfSubFailedModal").show();if(failedLicenseObj.isPayPal){$("#mfSubFailedBtn").attr("href","http://www.paypal.com");}if(failedLicenseObj.isFastSpring){var arr=failedLicenseObj.txnID.split("--__--");if(arr.length==7){var str=failedLicenseObj.txnID;var arr=str.split("--__--");$("#mfSubFailedBtn").attr("href",arr[6]);}else{var str=failedLicenseObj.txnID;var arr=str.split("--__--");$("#mfSubFailedBtn").attr("href",arr[5]);}}mf_main.interfaceResize();}if(MF_UserSession.getUser().teamPremium){if(thisClass.totalLicenses==0){$("#mfAddLicenseUserInput").hide();$("#mfAddLicenseUserBtn").hide();$("#mfTeamLicenseOwnerAlert").css("display","inline-block");$(".mfLicenseCountWrapper, #mfAccountUserLicenseList").hide();$(".mfLicenseListWrapper").css("width","100%");$(".mfLicenseListDetailWrapper").css("border","none");$("#mfTeamLicenseOwnerAlert").text("Your license is managed by "+MF_UserSession.getUser().teamLicenseOwner);}}}});}};this.applySubscriptionTemplate=function(){$("#mfSubscriptionList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfSubscriptionTemplate");if(cachedTemplate==null){$.get("templates/dashboard/SubscriptionItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfSubscriptionTemplate").html());mf_main.addTemplateToCache("mfSubscriptionTemplate",template);thisClass.renderSubscriptionItem(template);});}else{thisClass.renderSubscriptionItem(cachedTemplate);}};this.renderSubscriptionItem=function(template){for(var i=0;i<thisClass.licenseCollection.size();i++){var item=thisClass.licenseCollection.getItemAt(i);$("#mfSubscriptionList").append(template(item));$("#mfSubInvoiceBtn"+item.id).on("click",thisClass.openInvoiceModalHandler);$("#mfSubCancelBtn"+item.id).on("click",thisClass.cancelSubHandler);$("#mfSubBillingBtn"+item.id).on("click",thisClass.billingSubHandler);}if(thisClass.licenseCollection.size()==0){$("#mfSubscriptionPlaceHolder").show();$("#mfSubscriptionList").hide();}else{$("#mfSubscriptionPlaceHolder").hide();$("#mfSubscriptionList").show();}$("#mfSubscriptionListLoader").hide();};this.cancelSubHandler=function(e){var selClass=$(this).attr("id");thisClass.selectedLicense=thisClass.getSelectedLicenseByCancelBtn(selClass);if(thisClass.selectedLicense!=null){if(thisClass.selectedLicense.isPayPal){var answer=confirm("Do you want to cancel this subscription "+thisClass.selectedLicense.txnID+" from auto-renewal ? \n\nNote: This will make the subscription automatically expire after its end date.\n\nThe current subscription rates have been increased significantly (https://mockflow.com/pricing), so when you cancel and re-subscribe only the new rates will apply.");if(answer){window.open("http://www.paypal.com","_blank");}}if(thisClass.selectedLicense.isFastSpring){var arr=thisClass.selectedLicense.txnID.split("--__--");if(arr.length==7){var answer=confirm("Do you want to cancel this subscription "+arr[5]+" from auto-renewal ? \n\nNote: This will make the subscription automatically expire after its end date.");if(answer){var str=thisClass.selectedLicense.txnID;var arr=str.split("--__--");window.open(arr[6],"_blank");}}else{var answer=confirm("Do you want to cancel this subscription "+arr[4]+" from auto-renewal ? \n\nNote: This will make the subscription automatically expire after its end date.");if(answer){var str=thisClass.selectedLicense.txnID;var arr=str.split("--__--");window.open(arr[5],"_blank");}}}}};this.billingSubHandler=function(e){var selClass=$(this).attr("id");thisClass.selectedLicense=thisClass.getSelectedLicenseByBillingBtn(selClass);if(thisClass.selectedLicense!=null){if(thisClass.selectedLicense.isPayPal){window.open("http://www.paypal.com","_blank");}if(thisClass.selectedLicense.isFastSpring){var arr=thisClass.selectedLicense.txnID.split("--__--");if(arr.length==7){var str=thisClass.selectedLicense.txnID;var arr=str.split("--__--");window.open(arr[6],"_blank");}else{var str=thisClass.selectedLicense.txnID;var arr=str.split("--__--");window.open(arr[5],"_blank");}}}};this.openInvoiceModalHandler=function(e){var selClass=$(this).attr("id");thisClass.selectedLicense=thisClass.getSelectedLicense(selClass);if(thisClass.selectedLicense!=null){mf_main.closeDialog();var txnid=thisClass.selectedLicense.txnID;if(thisClass.selectedLicense.isFastSpring){alert("Invoice is automatically sent to your billing email after each transaction from our payment provider - FastSpring");return;var arr=thisClass.selectedLicense.txnID.split("--__--");if(arr.length==7){txnid=arr[4];}else{txnid=arr[3];}}$("#mfInvoiceModalTitle").text("Generate Invoice: "+txnid);var a=moment(thisClass.selectedLicense.createDateFormat,["YYYY-MM-DD"]);var b=moment(thisClass.selectedLicense.periodFormat,["YYYY-MM-DD"]);if(thisClass.selectedLicense.isMonthly){var diff=b.diff(a,"months");$("#mfInvoiceDateSelect").empty();for(var i=diff-1;i>=0;i--){var vald=moment(thisClass.selectedLicense.createDateFormat,["YYYY-MM-DD"]).add("months",i).format("LL");$("#mfInvoiceDateSelect").append('<option value="'+vald+'">'+vald+"</option>");}}else{var diff=b.diff(a,"years");$("#mfInvoiceDateSelect").empty();for(var i=diff-1;i>=0;i--){var vald=moment(thisClass.selectedLicense.createDateFormat,["YYYY-MM-DD"]).add("years",i).format("LL");$("#mfInvoiceDateSelect").append('<option value="'+vald+'">'+vald+"</option>");}}$("#mfInvoiceModal").modal();}};this.applyLicenseUserTemplate=function(){$("#mfAccountUserLicenseList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfLicenseUserTemplate");if(cachedTemplate==null){$.get("templates/dashboard/LicenseUserItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfLicenseUserTemplate").html());mf_main.addTemplateToCache("mfLicenseUserTemplate",template);thisClass.renderLicenseUserItem(template);});}else{thisClass.renderLicenseUserItem(cachedTemplate);}};this.renderLicenseUserItem=function(template){for(var i=0;i<thisClass.licenseUserCollection.size();i++){var item=thisClass.licenseUserCollection.getItemAt(i);$("#mfAccountUserLicenseList").append(template(item));$("#mfLicenseUserItem"+item.id+" .mfLicenseUserItemRole").val(item.role);}$(".mfLicenseUserDelBtn").on("click",thisClass.deleteLicenseUserHandler);$(".mfLicensePortDelBtn").on("click",thisClass.transferDataUserHandler);$(".mfLicenseUserItemRole").on("change",thisClass.updateLicenseUserRoleHandler);if(thisClass.totalLicenses!=0){$("#mfAccountUserLicenseList").show();$("#mfAddLicenseUserBtn").css("border-bottom-right-radius","0px");}$("#mfAccountUserLicenseListLoader").hide();$("#mfAccountUserLicenseListEmpty").hide();$(".mfLicenseTooltip").tooltip({container:"body"});};this.deleteLicenseUserHandler=function(e){var selu=$(this).attr("id");selu=selu.replace("mfLicenseUserDelBtn","");var selectedLicenseUser=thisClass.selectLicenseUser(selu);if(selectedLicenseUser!=null){if(selectedLicenseUser.email.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){alert("You cannot downgrade yourself. Contact MockFlow Support (mockflow@produle.com) for details.");return;}var answer=confirm("Downgrade this user license ("+selectedLicenseUser.email+") to Basic ?");if(answer){thisClass.deleteLicenseUser(selectedLicenseUser);}}};this.transferDataUserHandler=function(e){if(isEnterprise){var selu=$(this).attr("id");selu=selu.replace("mfLicenseUserTransferBtn","");var selectedLicenseUser=thisClass.selectLicenseUser(selu);if(selectedLicenseUser!=null){var answer=confirm("Initiate data transfer from this user account ("+selectedLicenseUser.email+") to another user ?");if(answer){MF_Authentication.addSecureTransferToInitiate(MF_UserSession.getUser(),selectedLicenseUser.email,{callback:function(res){if(res!="success"){alert("Operation failed");}else{alert("Follow instructions in the email sent to '"+selectedLicenseUser.email+"' to initiate data transfer.");}}});}}}else{var ans=confirm("NOTE: Data migration allows to easily transfer all data from one user to another.\n\nThis is useful when a user is leaving your company and wants to migrate their data to another user.\n\nData migration is only available for annual TeamPack users. Do you want to upgrade your license?");if(ans){window.open("https://mockflow.com/pricing","_self");}}};this.selectLicenseUser=function(pid){for(var i=0;i<thisClass.licenseUserCollection.size();i++){var item=thisClass.licenseUserCollection.getItemAt(i);if(item.id==pid){return item;}}return null;};this.searchLicenseUserHandler=function(e){var searchval=$("#mfAddLicenseUserInput").val().trim().toLowerCase();var userExist=false;for(var i=0;i<thisClass.licenseUserCollection.size();i++){var item=thisClass.licenseUserCollection.getItemAt(i);if(item.email.toLowerCase().indexOf(searchval)>=0){$("#mfLicenseUserItem"+item.id).show();userExist=true;}else{$("#mfLicenseUserItem"+item.id).hide();}}if(userExist){$("#mfAccountUserLicenseList").show();$("#mfAccountUserLicenseListEmpty").hide();}else{if(thisClass.licenseUserCollection.size()>0){$("#mfAccountUserLicenseList").hide();$("#mfAccountUserLicenseListEmpty").show();}}};this.enterLicenseUserHandler=function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode=="13"){thisClass.addLicenseUserHandler();}};this.displayLicenseAlert=function(){if(thisClass.usedLicenses<thisClass.totalLicenses){if(isEnterprise){$("#mfDetailsLicenseAlert").hide();}else{$("#mfDetailsLicenseAlert").css("display","block");$("#mfDetailsLicenseAlert").text((thisClass.totalLicenses-thisClass.usedLicenses).toString());}}else{$("#mfDetailsLicenseAlert").css("display","none");}};this.addLicenseUserHandler=function(e){thisClass.emailCollection=$("#mfAddLicenseUserInput").val().split(",");$("#mfAddLicenseUserInput").val("");$("#mfAccountUserLicenseListEmpty").hide();if(thisClass.licenseUserCollection.size()>0){$("#mfAccountUserLicenseList,#mfAccountUserLicenseList .mfLicenseUserItemWrapper").show();}if(thisClass.emailCollection.length>30){alert("Alert! Only maximum of 30 users can be upgraded at a time.");}thisClass.upgradeUser(thisClass.emailCollection.pop().trim());};this.upgradeUser=function(useremail){if((thisClass.totalLicenses-thisClass.usedLicenses)>0){var userID=useremail;userID=MF_Utils.trim(userID);userID=userID.toLowerCase();if(userID.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){MF_Utils.display_ActionIndicator("You cannot upgrade yourself");if(thisClass.emailCollection&&thisClass.emailCollection.length>0){thisClass.upgradeUser(thisClass.emailCollection.pop().trim());}return;}if(userID==""){if(thisClass.emailCollection&&thisClass.emailCollection.length>0){thisClass.upgradeUser(thisClass.emailCollection.pop().trim());}return;}if(thisClass.isUserLicenseExist(userID)){MF_Utils.display_ActionIndicator("User already exists");if(thisClass.emailCollection&&thisClass.emailCollection.length>0){thisClass.upgradeUser(thisClass.emailCollection.pop().trim());}return;}if(!MF_Utils.isValidEmailAddress(userID)){MF_Utils.display_ActionIndicator("Invalid email");if(thisClass.emailCollection&&thisClass.emailCollection.length>0){thisClass.upgradeUser(thisClass.emailCollection.pop().trim());}return;}$("#mfSubscriptionUserAddLoader").show();MF_LicenseManager.addLicenseUser(MF_UserSession.getUser(),MF_UserSession.getUser().username,userID,{callback:function(str){if(str=="exists"||str=="fail"){if(str=="fail"){alert("Some error occurred for "+userID+". Contact mockflow@produle.com");}else{alert("This user "+userID+" is already upgraded");}}else{if(str=="added"){var newuser=new MF_LicenseUser();newuser.id=MF_Utils.guidGenerator();newuser.clientid=MF_UserSession.getUser().company;newuser.createDate=new Date();newuser.email=userID;thisClass.usedLicenses=thisClass.usedLicenses+1;$("#mfAssignedLicense").text(thisClass.usedLicenses.toString());$("#mfTotalLicense").text(thisClass.totalLicenses.toString());thisClass.displayLicenseAlert();thisClass.licenseUserCollection.addItem(newuser);thisClass.applyLicenseUserTemplate();mf_main.logController.upgradeTeamMember(userID);MF_Utils.display_ActionIndicator("License for the user "+userID+" has been successfully upgraded");}}$("#mfSubscriptionUserAddLoader").hide();if(thisClass.emailCollection&&thisClass.emailCollection.length>0){thisClass.upgradeUser(thisClass.emailCollection.pop().trim());}}});}else{MF_Utils.display_ActionIndicator("No licenses available. Purchase additional license to proceed adding new users");}};this.deleteLicenseUser=function(selectedLicenseUser){if(selectedLicenseUser!=null){$("#mfLicenseUserItem"+selectedLicenseUser.id).css("height","0px");$("#mfLicenseUserItem"+selectedLicenseUser.id).css("display","none");var lind=thisClass.licenseUserCollection.getItemIndex(selectedLicenseUser);if(lind!=-1){thisClass.licenseUserCollection.removeItemAt(lind);}$("#mfAssignedLicense").text((thisClass.usedLicenses-1).toString());$("#mfAddLicenseUserInput").val("");$(".mfLicenseTooltip").tooltip("hide");thisClass.applyLicenseUserTemplate();MF_LicenseManager.deleteLicenseUser(MF_UserSession.getUser(),MF_UserSession.getUser().username,selectedLicenseUser.email,{callback:function(str){if(str=="deleted"){thisClass.usedLicenses=thisClass.usedLicenses-1;$("#mfAssignedLicense").text(thisClass.usedLicenses.toString());$("#mfTotalLicense").text(thisClass.totalLicenses.toString());thisClass.displayLicenseAlert();mf_main.logController.downgradeTeamMember(selectedLicenseUser.email);}else{if(str=="deletedfail"){alert("Some error occurred. Contact mockflow@produle.com");}}}});}};this.isUserLicenseExist=function(email){for(var i=0;i<thisClass.licenseUserCollection.size();i++){var item=thisClass.licenseUserCollection.getItemAt(i);if(item.email==email){return true;}}return false;};this.changeIDShowHandler=function(e){$("#mfChangeIDModalScreen1").show();$("#mfChangeIDModalScreen2").hide();$("#mfChangeIDModalCloseBtn").show();$("#mfChangeIDModalBtn").show();$("#mfChangeIDFooter").show();$("#mfChangeIDModalPass").val("");};this.changeIDShownHandler=function(e){$("#mfChangeIDModalPass").focus();};this.deleteMockFlowAccount=function(){if(MF_Utils.trim($("#mfDelAccountModalPass").val())==""){alert("Error! Password cannot be blank");return;}MF_Authentication.checkUser(MF_UserSession.getUser().username,$("#mfDelAccountModalPass").val(),{callback:function(user){if(user!=null){$("#mfDeletedAccountModal").modal();var purl="https://mockflow.com/common/";if(MF_Global.getS3Bucket()=="testmfassets"){purl="http://localhost:8080/MockFlow-Website/common/";}var dataString="userid="+encodeURIComponent(MF_UserSession.getUser().username)+"&tokenkey="+encodeURIComponent($("#mfDelAccountModalPass").val());thisClass.closeAccountSettings();$.post("mfproxy.jsp",{format:dataString,url:purl+"/deleteaccount.jsp"},function(data){mf_main.closeDialog();if(data.indexOf("success")>-1){alert("MockFlow Account deleted");window.location="https://www.mockflow.com/";}else{alert("Error! Account cannot be deleted");}});}else{$("#mfDelAccountModalPass").val("");alert("Your Password was wrong. Try again.");}}});};this.deleteMockFlowAccountGLogin=function(){$("#mfDeletedAccountModal").modal();var purl="https://mockflow.com/common/";if(MF_Global.getS3Bucket()=="testmfassets"){purl="http://localhost:8080/MockFlow-Website/common/";}var dataString="userid="+encodeURIComponent(MF_UserSession.getUser().username)+"&tokenkey="+encodeURIComponent(MF_UserSession.getUser().password);thisClass.closeAccountSettings();$.post("mfproxy.jsp",{format:dataString,url:purl+"/deleteaccount.jsp"},function(data){mf_main.closeDialog();if(data.indexOf("success")>-1){alert("MockFlow Account deleted");window.location="https://www.mockflow.com/";}else{alert("Error! Account cannot be deleted");}});};this.closeHandler=function(){$(".modal").modal("hide");};this.deleteAccountHandler=function(){if(!MF_UserSession.getUser().isBasic&&!MF_UserSession.getUser().isTrial){alert("Your account should be downgraded to Basic edition to be deleted.");return;}var answer=confirm('Do you want to delete this MockFlow Account: "'+MF_UserSession.getUser().username+'" ? \n\nThis will Erase all your data and account details from All MockFlow services permanently');if(answer){if(mf_main.thirdPartyAuthAccess!=null){var answer2=confirm('Are you sure you want to delete your MockFlow Account: "'+MF_UserSession.getUser().username+'" ?');if(answer2){thisClass.deleteMockFlowAccountGLogin();}}else{mf_main.closeDialog();$("#mfDelAccountModal").modal();}}};this.changeAccountUsernameHandler=function(){var newid=MF_Utils.trim($("#mfEditProfileIDInput").val());if(newid==""){alert("Error! User name cannot be blank");return;}if(newid.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){alert("The new ID is same as the old one");return;}if(!MF_Utils.isValidEmailAddress(newid)){alert("Invalid email");return;}if(mf_main.thirdPartyAuthAccess!=null){alert("You cannot change your MockFlow username by logging in with your Google / SSO Account. Inorder to change first create a MockFlow Password by following this article : \n\n https://support.mockflow.com/article/97-how-to-change-google-login-to-normal-mockflow-account \n\nAnd then login directly at https://mockflow.com/app to change your MockFlow account ID");return;}thisClass.tempChangeID=$("#mfEditProfileIDInput").val();mf_main.closeDialog();$("#mfChangeIDModal").modal();};this.updateProfileImage=function(){$("#mfDetailsProfileImg,#mfDetailsProfileImg2").attr("src",MF_UserSession.getUser().profileImage+"&timestamp="+new Date().getTime());$("#mfAccountProfileImg").css("background-image","url("+MF_UserSession.getUser().profileImage+"&timestamp="+new Date().getTime()+")");$("#mfAccountProfileImg2").css("background-image","url("+MF_UserSession.getUser().profileImage+"&timestamp="+new Date().getTime()+")");};this.changeProfileName=function(){if(MF_Utils.trim($("#mfEditProfileFirstNameInput").val())==""){alert("Error! First name cannot be blank");return;}MF_UserSession.getUser().firstName=$("#mfEditProfileFirstNameInput").val();MF_UserSession.getUser().lastName=$("#mfEditProfileLastNameInput").val();var purl="https://mockflow.com/common/";if(MF_Global.getS3Bucket()=="testmfassets"){purl="http://localhost:8080/MockFlow-Website/common/";}var dataString="fname="+encodeURIComponent(MF_UserSession.getUser().firstName)+"&lname="+encodeURIComponent(MF_UserSession.getUser().lastName)+"&userid="+encodeURIComponent(MF_UserSession.getUser().username)+"&tokenkey="+encodeURIComponent(MF_UserSession.getUser().password);thisClass.closeAccountSettings();$.post("mfproxy.jsp",{format:dataString,url:purl+"/changename.jsp"},function(data){if(data.indexOf("success")>-1){alert("Profile Name has been updated");}else{alert("Error! Profile Name cannot be updated");}});};this.changeAccountUsername=function(){if(MF_Utils.trim($("#mfChangeIDModalPass").val())==""){alert("Error! Password cannot be blank");return;}$("#mfChangeIDModalScreen2").show();$("#mfChangeIDModalScreen1").hide();$("#mfChangeIDModalCloseBtn").hide();$("#mfChangeIDModalBtn").hide();$("#mfChangeIDFooter").hide();var purl="https://mockflow.com/common/";if(MF_Global.getS3Bucket()=="testmfassets"){purl="http://localhost:8080/MockFlow-Website/common/";}var dataString="oldid="+encodeURIComponent(MF_UserSession.getUser().username)+"&newid="+encodeURIComponent(thisClass.tempChangeID)+"&tokenkey="+encodeURIComponent($("#mfChangeIDModalPass").val());thisClass.closeAccountSettings();$.post("mfproxy.jsp",{format:dataString,url:purl+"/changeid.jsp"},function(data){mf_main.closeDialog();if(data.indexOf("fail")>-1){alert("Some Error occurred!");}else{if(data.indexOf("wrongpass")>-1){alert("Wrong password!");}else{if(data.indexOf("exists")>-1){alert("A MockFlow account already exists with this Email ID");}else{MF_UserSession.getUser().username=thisClass.tempChangeID;var conf=confirm("Your MockFlow ID has been changed, Please immediately restart the application");if(conf){window.location="https://www.mockflow.com/";}else{window.location="https://www.mockflow.com/";}}}}});};this.bindData=function(){$("#mfDetailsProfileName").text(MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName);$("#mfDetailsProfileUserName").text(MF_UserSession.getUser().username);if(MF_UserSession.getUser().teamPremium){$("#mfDetailsProfileAccTypelbl").text("Team-Pack");}else{if(MF_UserSession.getUser().isTrial){$("#mfDetailsProfileAccTypelbl").text("Premium Trial");}else{$("#mfDetailsProfileAccTypelbl").text(MF_UserSession.getUser().accountType);}}$("#mfDetailsProfileJoinDatelbl").text(MF_UserSession.getUser().createDateStr);$("#mfEditProfileFirstNameInput").val(MF_UserSession.getUser().firstName);$("#mfEditProfileLastNameInput").val(MF_UserSession.getUser().lastName);$("#mfEditProfileIDInput").val(MF_UserSession.getUser().username);thisClass.getSSOSettings();};this.hideAllAccountCanvas=function(){$("#mfAccountSettingsProfile").css("display","none");$("#mfAccountSettingsLicense").css("display","none");$("#mfAccountSettingsPassword").css("display","none");$("#mfAccountSettingsNotification").css("display","none");$("#mfAccountSettingsSubscription").css("display","none");$("#mfAccountSettingsSSO").css("display","none");};this.openProfileCanvas=function(){thisClass.hideAllAccountCanvas();$("#mfAccountSettingsProfile").css("display","block");};this.openLicenseCanvas=function(){thisClass.hideAllAccountCanvas();$("#mfAccountSettingsLicense").css("display","block");};this.openSSOCanvas=function(){thisClass.hideAllAccountCanvas();$("#mfAccountSettingsSSO").css("display","block");};this.openPasswordCanvas=function(){thisClass.hideAllAccountCanvas();$("#mfAccountSettingsPassword").css("display","block");};this.openNotificationCanvas=function(){thisClass.hideAllAccountCanvas();$("#mfAccountSettingsNotification").css("display","block");};this.openSubscriptionCanvas=function(){thisClass.hideAllAccountCanvas();$("#mfAccountSettingsSubscription").css("display","block");};this.accountBtnClick=function(e){thisClass.openAccountTab($(this).attr("id"));$(".mfSettingsTabPanel li").removeClass("active");$(this).addClass("active");};this.openAccountTab=function(hid){thisClass.refreshAccountBtns();thisClass.selectedAccountBtnID=hid;if(hid=="mfAccountProfileBtn"){thisClass.openProfileCanvas();}if(hid=="mfAccountPasswordBtn"){thisClass.openPasswordCanvas();}if(hid=="mfAccountNotificationBtn"){thisClass.openNotificationCanvas();}if(hid=="mfAccountSubscriptionBtn"){thisClass.openSubscriptionCanvas();}if(hid=="mfAccountLicenseBtn"){thisClass.openLicenseCanvas();}if(hid=="mfAccountSSOBtn"){thisClass.openSSOCanvas();}};this.refreshAccountBtns=function(){$(".mfAccountSettingBtn").css({opacity:1});};this.accountBtnOver=function(e){if($(this).attr("id")!=thisClass.selectedAccountBtnID){$(this).css({opacity:0.5});}};this.accountBtnOut=function(e){if($(this).attr("id")!=thisClass.selectedAccountBtnID){$(this).css({opacity:1});}};this.licenseBtnClick=function(e){thisClass.selectedLicenseTab=$(this).attr("id");if(thisClass.selectedLicenseTab=="mfAccountUserLicenseBtn"){$("#mfAccountUserLicenseBtn").css("color","#666");$("#mfAccountUserLicenseBtn").css("border-color","#fff");$("#mfAccountSubscriptionBtn").css("color","#000");$("#mfAccountSubscriptionBtn").css("border-color","#000");$("#mfAccountSubscriptionCanvas").css("display","none");$("#mfAccountUserLicenseCanvas").css("display","block");}if(thisClass.selectedLicenseTab=="mfAccountSubscriptionBtn"){$("#mfAccountSubscriptionBtn").css("color","#666");$("#mfAccountSubscriptionBtn").css("border-color","#fff");$("#mfAccountUserLicenseBtn").css("color","#000");$("#mfAccountUserLicenseBtn").css("border-color","#000");$("#mfAccountUserLicenseCanvas").css("display","none");$("#mfAccountSubscriptionCanvas").css("display","block");}};this.licenseBtnOver=function(e){if($(this).attr("id")!=thisClass.selectedLicenseTab){$(this).css("color","#666");}};this.licenseBtnOut=function(e){if($(this).attr("id")!=thisClass.selectedLicenseTab){$(this).css("color","#666");}};this.emailNotificationHandler=function(e){var $this=$(this);if($this.is(":checked")){remember=true;}else{remember=false;}var appname=$(this).attr("data-mfapp");if(appname){MF_AccountManager.updateCommentAlert(MF_UserSession.getUser(),remember,appname,{callback:function(){}});}};this.setEmailAlerts=function(){var emailAlerts=MF_UserSession.getUser().emailAlert.flag;for(var key in emailAlerts){$("#mfAccountSettingsNotification .mfEditProfileEmailChk[data-mfapp="+key+"]").attr("checked",emailAlerts[key]);}};this.openPhotoOptionsPopup=function(e){e.stopPropagation();var ImgoffsetLeft=260;$("#mfChoosePhotoPopup").css("left",ImgoffsetLeft+"px");$("#mfChoosePhotoPopup").show();$("#mfChoosePhotoPopup").animate({left:ImgoffsetLeft-30+"px"},300,"easeOutBack");};this.profileUploadFileSelectHandler=function(e){thisClass.usingFPIO=false;thisClass.uploadFileTemp=null;var file=document.getElementById("mfProfilePhotoUploadFile").files[0];thisClass.handleFileUpload(file);};this.handleFileUpload=function(file){var pass=true;if(file){var fileSize=0;fileSize=parseInt(file.size/1024,10);var ext=file.name.split(".").pop().toLowerCase();if($.inArray(ext,["gif","png","jpg","jpeg"])==-1){alert("Invalid File extension !");return false;}if(!file.type.match(/image.*/)){pass=false;alert("Only images are allowed!");$("#mfProfilePhotoUploadFile").attr({value:""});return false;}fileSize=fileSize/1000;if(fileSize>10){pass=false;$("#mfProfilePhotoUploadFile").attr({value:""});alert("The allowed file size is 10 MB or less. Compress your image before uploading.");return false;}if(pass){thisClass.uploadFileTemp=file;var filename=file.name;var lastIndex=filename.lastIndexOf("\\");if(lastIndex>=0){filename=filename.substring(lastIndex+1);}thisClass.img=new Image();var reader=new FileReader();reader.onload=function(e){thisClass.img.onload=function(){$("#mfProfilePhotoUploadFile").attr({value:""});$("#mfDialogBackground").show();$("#mfMyProfileModal").show();$(".mfPhotoViewerCls").hide();$("#mfAccountPhotoProfileUpload").show();$("#mfProfileUploadTempView img").attr("src",e.target.result);$("#mfProfileUploadTempView img").removeAttr("style");thisClass.img.newImgWidth=$("#mfProfileUploadTempView img").width();$("#mfProfileUploadTempView img").width(thisClass.img.newImgWidth);thisClass.draggable("mfProfileUploadTempViewImg");thisClass.makeProfileImageDraggableAndResizable();$("#mfProfileUploadTempView").show();};thisClass.img.src=e.target.result;thisClass.isImageUpload=false;};reader.readAsDataURL(thisClass.uploadFileTemp);}}};this.draggable=function(id){var el=document.getElementById(id),isDragReady=false,dragoffset={x:0,y:0};this.init=function(){el.style.position="absolute";this.events();};this.events=function(){var self=this;$("#mfProfileUploadTempViewImg").on("mousedown.profilecrop",function(e){isDragReady=true;e.pageX=e.pageX||e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft);e.pageY=e.pageY||e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop);dragoffset.x=e.pageX-el.offsetLeft;dragoffset.y=e.pageY-el.offsetTop;e.preventDefault();$(document).on("mouseup.profilecrop",function(){isDragReady=false;$(document).off("mouseup.profilecrop");$(document).off("mousemove.profilecrop");});$(document).on("mousemove.profilecrop",function(e){if(isDragReady){e.pageX=e.pageX||e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft);e.pageY=e.pageY||e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop);var imgWidth=$("#mfProfileUploadTempView img").width();var imgHeight=$("#mfProfileUploadTempView img").height();var containerWidth=200,containerHeight=200;var left=thisClass.fill(e.pageX-dragoffset.x,imgWidth,containerWidth);var top=thisClass.fill(e.pageY-dragoffset.y,imgHeight,containerHeight);el.style.top=top+"px";el.style.left=left+"px";}});});};this.init();};this.fill=function(value,target,container){if(value+target<container){value=container-target;}return value>0?0:value;};this.makeProfileImageDraggableAndResizable=function(){$("#mfProfileImgslider").val(1);$("#mfProfileUploadTempView img").width(thisClass.img.newImgWidth);$("#mfProfileUploadTempView img").height(200);$("#mfProfileUploadTempView img").css({left:"0",top:"0px"});$("#mfProfileImgslider").on("change",function(e){if(this.value==1){$("#mfProfileUploadTempView img").width(thisClass.img.newImgWidth);$("#mfProfileUploadTempView img").height(200);$("#mfProfileUploadTempView img").css({left:"0",top:"0px"});}else{var width=thisClass.img.newImgWidth*this.value;var height=200*this.value;$("#mfProfileUploadTempView img").width(width);$("#mfProfileUploadTempView img").height(height);$("#mfProfileUploadTempView img").css({left:"0",top:"0px"});}});};this.mfUseUploadedProfilePhoto=function(e){e.stopImmediatePropagation();var canvas=document.createElement("canvas");canvas.width=$("#mfProfileUploadTempView img").width();canvas.height=$("#mfProfileUploadTempView img").height();var ctx=canvas.getContext("2d");ctx.fillStyle="#FFFFFF";ctx.fill();var offsetleft=$("#mfProfileUploadTempView").offset().left-$("#mfProfileUploadTempView img").offset().left;var offsetTop=$("#mfProfileUploadTempView").offset().top-$("#mfProfileUploadTempView img").offset().top;var img=new Image();img.src=thisClass.img.src;img.onload=function(){ctx.drawImage(img,0,0,$("#mfProfileUploadTempView img").width(),$("#mfProfileUploadTempView img").height());var dataURL=canvas.toDataURL("image/jpeg");var canvas_new=document.createElement("canvas");canvas_new.width=200;canvas_new.height=200;var ctx_new=canvas_new.getContext("2d");ctx_new.fillStyle="#FFFFFF";ctx_new.fill();var imgData=ctx.getImageData(offsetleft,offsetTop,200,200);ctx_new.putImageData(imgData,0,0);var dataURL_new=canvas_new.toDataURL("image/jpeg");$(canvas).remove();$(canvas_new).remove();$(".mfPhotoViewerCls").hide();$("#mfAccountLoadScreen").css("display","block");var thisUser=MF_UserSession.getUser();if($("#mfProfileUploadTempView img").hasClass("ui-draggable")){$("#mfProfileUploadTempView img").draggable("destroy");}thisClass.uploadProfilePhoto(thisUser,dataURL_new);};};this.openPhotoCanvas=function(e){$("#mfChoosePhotoPopup").hide();$("#mfDialogBackground").show();$("#mfMyProfileModal").show();$(".mfPhotoViewerCls").hide();$("#mfAccountLoadScreen").show();if(!("webcam" in mf_main.moduleCache)){var loadFiles=["js/external/webcam/webcam.min.js"];mf_main.moduleCache.webcam=true;MF_Utils.loadsScripts(loadFiles).done(function(){thisClass.openWebcam();});}else{thisClass.openWebcam();}};this.openWebcam=function(){thisClass.cameraON=true;Webcam.set({width:320,height:240,dest_width:320,dest_height:240,crop_width:240,crop_height:240,image_format:"jpeg",jpeg_quality:90});Webcam.attach("#mfCameraShot");$("#mfAccountPhotoProfileCamera").show();$("#mfAccountLoadScreen").hide();};this.takePhoto=function(){Webcam.snap(function(data_uri){Webcam.reset();$(".mfPhotoViewerCls").hide();$("#mfAccountLoadScreen").css("display","block");var thisUser=MF_UserSession.getUser();thisClass.uploadProfilePhoto(thisUser,data_uri);});};this.uploadProfilePhoto=function(user,data_uri){var userEmail=MF_Utils.getMD5(user.username);MF_AccountManager.uploadProfilePhoto(user,userEmail,data_uri,{callback:function(){thisClass.updateProfileImage();thisClass.closeMyProfileModal();}});};this.removeProfilePhoto=function(e){var thisUser=MF_UserSession.getUser();var userMD5hash=MF_Utils.getMD5(thisUser.username);var removeS3Lnk="app/mockflow/profilephoto/user/"+userMD5hash;MF_AccountManager.removeProfileImage(thisUser,removeS3Lnk,{callback:function(){thisClass.updateProfileImage();mf_main.closePopUpHandler();}});};this.closeMyProfileModal=function(){$("#mfDialogBackground").hide();$("#mfMyProfileModal").hide();if(thisClass.cameraON){thisClass.cameraON=false;Webcam.reset();}};this.SSOSettingsSaveHandler=function(){var currentUser=MF_UserSession.getUser();if(currentUser.accountType!="Enterprise"||currentUser.username!=currentUser.teamLicenseOwner){return;}var SSOEnabled=false;if($("#mfSSOSettingsEnabled").attr("checked")=="checked"){SSOEnabled=true;}if(SSOEnabled&&MF_Utils.trim($("#mfSSOSettingsProviderInput").val())==""){alert("Error! Provider cannot be blank");return;}if(SSOEnabled&&MF_Utils.trim($("#mfSSOSettingsSigninURLInput").val())==""){alert("Error! Sign-In URL cannot be blank");return;}if(SSOEnabled&&MF_Utils.trim($("#mfSSOSettingsIssuerIdInput").val())==""){alert("Error! Issuer Id URL cannot be blank");return;}if(SSOEnabled&&MF_Utils.trim($("#mfSSOSettingsCertificateInput").val())==""){alert("Error! Certificate cannot be blank");return;}var SSOSettings=new MF_SSOSettings();SSOSettings.clientid=currentUser.company;SSOSettings.enabled=SSOEnabled;SSOSettings.provider=MF_Utils.trim($("#mfSSOSettingsProviderInput").val());SSOSettings.issuerid=MF_Utils.trim($("#mfSSOSettingsIssuerIdInput").val());SSOSettings.signinurl=MF_Utils.trim($("#mfSSOSettingsSigninURLInput").val());SSOSettings.certificate=MF_Utils.trim($("#mfSSOSettingsCertificateInput").val());$("#mfSSOSettingsSaveBtn").addClass("mfButtonLoadState");$("#mfSSOSettingsSaveBtn").text("Saving...");MF_AccountManager.saveSSOSettings(MF_UserSession.getUser(),SSOSettings,{callback:function(result){$("#mfSSOSettingsSaveBtn").removeClass("mfButtonLoadState");$("#mfSSOSettingsSaveBtn").text("Save");if(result=="success"){alert("Settings saved successfully");}else{alert("Error occured while saving the settings");}}});};this.getSSOSettings=function(){var currentUser=MF_UserSession.getUser();if(currentUser.accountType!="Enterprise"||currentUser.username!=currentUser.teamLicenseOwner){return;}$("#mfSSOSettingsCustomDataWrapper").hide();MF_AccountManager.getSSOSettings(MF_UserSession.getUser(),{callback:function(SSOSettings){if(SSOSettings!=null){if(SSOSettings.enabled){$("#mfSSOSettingsEnabled").attr("checked","checked");$("#mfSSOSettingsWrapper").removeClass("mfSSOSettingsWrapperDisabled");}$("#mfSSOSettingsProviderInput option[value="+SSOSettings.provider+"]").attr("selected","selected");$("#mfSSOSettingsIssuerIdInput").val(SSOSettings.issuerid);$("#mfSSOSettingsSigninURLInput").val(SSOSettings.signinurl);$("#mfSSOSettingsCertificateInput").val(SSOSettings.certificate);thisClass.SSOProviderHandler();}}});};this.SSOProviderHandler=function(){if($("#mfSSOSettingsProviderInput").val()=="custom"){$("#mfSSOSettingsCustomDataWrapper").show();}else{$("#mfSSOSettingsCustomDataWrapper").hide();}};this.updateLicenseUserRoleHandler=function(){var licenseUserEmail=$(this).attr("data-email");var licenseUserClientId=$(this).attr("data-clientid");var licenseUserRole=$(this).val();for(var i=0;i<thisClass.licenseUserCollection.size();i++){var item=thisClass.licenseUserCollection.getItemAt(i);if(item.email==licenseUserEmail){item.role=licenseUserRole;}}if(thisClass.currentUserRole=="owner"&&MF_UserSession.getUser().username.toLowerCase()!=licenseUserEmail.toLowerCase()){MF_LicenseManager.updateLicenseUserRole(MF_UserSession.getUser(),licenseUserClientId,licenseUserEmail,licenseUserRole,{callback:function(response){if(response!="success"){alert(response);}}});}};}